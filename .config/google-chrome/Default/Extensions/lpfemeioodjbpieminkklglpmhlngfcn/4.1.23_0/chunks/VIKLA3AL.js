import{a as te}from"./U7YUGQAA.js";import{b as U,d as G,k as $,m as X,s as Y}from"./X2SRSDMC.js";import{e as H,h as L}from"./4LWFKDT3.js";import{a as x}from"./USLLVG5P.js";import{K,U as Z,W as j,ba as ye,l as W,m as Q,q as J}from"./W7JCQNRZ.js";import{na as q,w as v,za as ee}from"./NVVQBQGC.js";import{a as S}from"./SZ3C6HJE.js";import{f}from"./UTGLRY7A.js";var oe={PromptApp:$,PromptRunner:X,WebAccessToolbar:G,GlobalSnackbar:"webchatgpt-snackbar"};function re(o){return o&&oe[o]&&document.querySelector(`#${oe[o]}`)?.shadowRoot?.querySelector("div:first-of-type")||document.body}function Re(o){for(let e of o){let r=document.querySelector(e);if(r)return r}}var Se=o=>{let{containerId:e,presetContainerElement:r,shadowRootId:i,presetShadowRootElement:a,webComponent:C=!0}=o,l="customElements"in window,p=document.createElement(l&&C?`webchatgpt-custom-element-${x()}`:"div");i&&(p.id=i),a&&a(p);let P=p.attachShadow({mode:"open"}),u=document.createElement("style");e&&(u.id=`${e}-emotion-style`);let c=document.createElement("div");return e&&(c.id=e),r&&r(p),P.appendChild(u),P.appendChild(c),{container:c,shadowRoot:p,emotionRoot:u}};function Ie(o,e){e.parentNode.insertBefore(o,e.nextSibling)}function ne(o,e){return document.querySelector(`#${o}`)?.shadowRoot?.querySelector(e)}var n=f(S());var F=f(S()),w=f(v()),Ce=o=>{let{src:e,alt:r,width:i,height:a,skeletonHeight:C}=o,[l,p]=F.default.useState(!1),[,P]=F.default.useState(!1);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("img",{src:e,alt:r,width:l?i:0,height:l?a:0,onLoad:()=>{p(!0)},onError:()=>{p(!0),P(!0)}}),!l&&(0,w.jsx)(Z,{variant:"rounded",height:C||a,width:i||"100%"})]})},ie=Ce;var se=f(S());var ae=o=>(0,se.useMemo)(()=>{let e=Y(o);return{title:e.title,description:e.description,ctaButtonText:e.ctaButtonText,ctaButtonLink:e.ctaButtonLink,ctaButtonOnClick:e.ctaButtonOnClick,imageUrl:e.imageUrl,videoUrl:e.videoUrl,sceneType:o}},[o]);var E=f(S());var I=f(S());function Te(o){let e=(0,I.useRef)(),r=(0,I.useRef)(!1),i=(0,I.useRef)(!1);r.current&&(i.current=!0),(0,I.useEffect)(()=>{if(!r.current)return r.current=!0,e.current=o(),()=>{i.current&&e.current&&e.current()}},[])}var pe=Te;var ce=f(S()),de=o=>{(0,ce.useEffect)(()=>{let e=()=>{o()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[])};var ue=(o=!0)=>{let[e,r]=(0,E.useState)(null),[i,a]=(0,E.useState)(!1),[C,l]=(0,E.useState)(!1);pe(()=>{l(!0),H().then(u=>{u&&r(u),a(!0),l(!1)}).catch(()=>{a(!0),l(!1)})}),de(()=>{o&&H().then(u=>{r(u)})});let p=(0,E.useMemo)(()=>!!e,[e]),P=(0,E.useMemo)(()=>e?L(e):"free",[e]);return{isLogin:p,userInfo:e,loaded:i,loading:C,currentUserPlan:P}};var s=f(v()),le="MAXAI_PERMISSION_WRAPPER_TOGGLE_EVENT",_="MAXAI_PERMISSION_WRAPPER_CUSTOM_EVENT";var he=o=>{let{sceneType:e,allowedRoles:r,mountContainerName:i,onPermission:a,BoxProps:C,TooltipProps:l,children:p,id:P,preAuth:u}=o,c=ae(e),[b,z]=(0,n.useState)(void 0),d=(0,n.useMemo)(()=>b||c,[c,b]),{currentUserPlan:g,userInfo:B,isLogin:O}=ue(),[me,R]=(0,n.useState)(!1),A=(0,n.useRef)(P??x());(0,n.useEffect)(()=>{let t=y=>{y.detail.id!==A.current&&R(y.detail.open)};return window.addEventListener(_,t),()=>{window.removeEventListener(_,t)}},[]),(0,n.useEffect)(()=>{let t=y=>{y.detail.id===A.current&&R(y.detail.open)};return window.addEventListener(le,t),()=>{window.removeEventListener(le,t)}},[]);let fe=(0,n.useMemo)(()=>!!r.find(t=>t===g),[g,r]),V=(0,n.useCallback)(async()=>{if(B&&O)return L(B);if(!O&&u){let t=await u();if(t)return L(t)}return null},[O,u,B]),Pe=(0,n.useMemo)(()=>i?Array.isArray(i)?ne(i[0],i[1]):re(i):document.body,[i]);return fe?(0,s.jsx)(s.Fragment,{children:p}):(0,s.jsx)(j,{arrow:!0,open:me,PopperProps:{container:Pe,sx:{"& > div":{maxWidth:320,p:1}}},title:(0,s.jsx)(J.default,{mouseEvent:"onMouseDown",onClickAway:()=>{R(!1)},children:(0,s.jsxs)(ee,{spacing:1,component:"div",onClick:t=>{t.stopPropagation()},children:[d.videoUrl&&(0,s.jsx)(te,{borderRadius:4,youtubeLink:d.videoUrl}),!d.videoUrl&&d.imageUrl&&(0,s.jsx)(W,{sx:{width:"100%",height:"auto",borderRadius:"4px",overflow:"hidden","& img":{width:"100%",height:"auto"}},children:(0,s.jsx)(ie,{height:140,src:d.imageUrl,alt:`${d.title} img`})}),(0,s.jsx)(q,{variant:"custom",fontSize:"16px",fontWeight:600,textAlign:"left",color:"rgba(255,255,255,.87)",children:d.title}),(0,s.jsx)(q,{variant:"custom",fontSize:"14px",fontWeight:400,textAlign:"left",color:"rgba(255,255,255,.87)",children:d.description}),d.ctaButtonText&&(0,s.jsx)(K,{target:"_blank",href:d.ctaButtonLink,onClick:t=>{t.preventDefault(),window.open(d.ctaButtonLink,"_blank"),d.ctaButtonOnClick?.(t),R(!1),U("click",c.sceneType)},children:(0,s.jsx)(Q,{fullWidth:!0,variant:"contained",children:d.ctaButtonText})})]})}),...l,children:(0,s.jsx)(W,{...C,children:(0,s.jsx)(W,{children:n.default.Children.map(p,t=>{if(n.default.isValidElement(t)){let y={...t.props,...t.props.onClick&&{onClick:async(m,...T)=>{let h=!1;m?.stopPropagation?.(),m?.preventDefault?.();let k=await V();if(r.includes(k||g)){t.props?.onClick?.(m,...T);return}if(a){let{success:N,cardSettings:D}=await a(k||g,c,[m,...T]);z({...c,...D}),h=N}let M=new CustomEvent(_,{detail:{id:A.current,open:!1}});window.dispatchEvent(M),R(!h),h?t.props?.onClick?.(m,...T):U("show",c.sceneType)}},...t.props.onChange&&{onChange:async(m,...T)=>{let h=!1;m?.stopPropagation?.(),m?.preventDefault?.();let k=await V();if(r.includes(k||g)){t.props?.onChange?.(m,...T);return}if(a){let{success:N,cardSettings:D}=await a(k||g,c,[m,...T]);z({...c,...D}),h=N}let M=new CustomEvent(_,{detail:{id:A.current,open:!1}});window.dispatchEvent(M),R(!h),h?t.props?.onChange?.(m,...T):U("show",c.sceneType)}}};return n.default.cloneElement(t,y)}return t})})})})},ot=he;export{re as a,Re as b,Se as c,Ie as d,pe as e,ue as f,ot as g};
