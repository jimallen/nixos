import{a as b}from"./USLLVG5P.js";import{c as f,f as L}from"./UTGLRY7A.js";var _e=f(O=>{"use strict";O.byteLength=Ze;O.toByteArray=tt;O.fromByteArray=it;var g=[],m=[],Xe=typeof Uint8Array<"u"?Uint8Array:Array,U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(E=0,fe=U.length;E<fe;++E)g[E]=U[E],m[U.charCodeAt(E)]=E;var E,fe;m["-".charCodeAt(0)]=62;m["_".charCodeAt(0)]=63;function me(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Ze(n){var e=me(n),t=e[0],r=e[1];return(t+r)*3/4-r}function et(n,e,t){return(e+t)*3/4-t}function tt(n){var e,t=me(n),r=t[0],i=t[1],s=new Xe(et(n,r,i)),o=0,u=i>0?r-4:r,a;for(a=0;a<u;a+=4)e=m[n.charCodeAt(a)]<<18|m[n.charCodeAt(a+1)]<<12|m[n.charCodeAt(a+2)]<<6|m[n.charCodeAt(a+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=m[n.charCodeAt(a)]<<2|m[n.charCodeAt(a+1)]>>4,s[o++]=e&255),i===1&&(e=m[n.charCodeAt(a)]<<10|m[n.charCodeAt(a+1)]<<4|m[n.charCodeAt(a+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function rt(n){return g[n>>18&63]+g[n>>12&63]+g[n>>6&63]+g[n&63]}function nt(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push(rt(r));return i.join("")}function it(n){for(var e,t=n.length,r=t%3,i=[],s=16383,o=0,u=t-r;o<u;o+=s)i.push(nt(n,o,o+s>u?u:o+s));return r===1?(e=n[t-1],i.push(g[e>>2]+g[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(g[e>>10]+g[e>>4&63]+g[e<<2&63]+"=")),i.join("")}});var be=f((jt,ye)=>{function _(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}ye.exports=_;_.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};_.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};_.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};_.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};_.prototype.try=function(n){this.attempt(n)};_.prototype.start=function(n){this.attempt(n)};_.prototype.start=_.prototype.try;_.prototype.errors=function(){return this._errors};_.prototype.attempts=function(){return this._attempts};_.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(n[s]||0)+1;n[s]=o,o>=t&&(e=i,t=o)}return e}});var we=f(C=>{var ut=be();C.operation=function(n){var e=C.timeouts(n);return new ut(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};C.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<e.retries;i++)r.push(this.createTimeout(i,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(i,e)),r.sort(function(s,o){return s-o}),r};C.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};C.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var i=0;i<t.length;i++){var s=t[i],o=n[s];n[s]=function(a){var c=C.operation(e),h=Array.prototype.slice.call(arguments,1),l=h.pop();h.push(function(A){c.retry(A)||(A&&(arguments[0]=c.mainError()),l.apply(this,arguments))}),c.attempt(function(){a.apply(n,h)})}.bind(n,o),n[s].options=e}}});var xe=f((Ft,ve)=>{ve.exports=we()});var Ee=f((Ht,R)=>{"use strict";var ct=xe(),lt=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],k=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},ht=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},dt=n=>lt.includes(n),Te=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let i=ct.operation(e);i.attempt(async s=>{try{t(await n(s))}catch(o){if(!(o instanceof Error)){r(new TypeError(`Non-error was thrown: "${o}". You should only throw errors.`));return}if(o instanceof k)i.stop(),r(o.originalError);else if(o instanceof TypeError&&!dt(o.message))i.stop(),r(o);else{ht(o,s,e);try{await e.onFailedAttempt(o)}catch(u){r(u);return}i.retry(o)||r(i.mainError())}}})});R.exports=Te;R.exports.default=Te;R.exports.AbortError=k});var Ae=f((qt,Y)=>{"use strict";var pt=Object.prototype.hasOwnProperty,p="~";function I(){}Object.create&&(I.prototype=Object.create(null),new I().__proto__||(p=!1));function ft(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Ce(n,e,t,r,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new ft(t,r||n,i),o=p?p+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],s]:n._events[o].push(s):(n._events[o]=s,n._eventsCount++),n}function M(n,e){--n._eventsCount===0?n._events=new I:delete n._events[e]}function d(){this._events=new I,this._eventsCount=0}d.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)pt.call(t,r)&&e.push(p?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};d.prototype.listeners=function(e){var t=p?p+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o};d.prototype.listenerCount=function(e){var t=p?p+e:e,r=this._events[t];return r?r.fn?1:r.length:0};d.prototype.emit=function(e,t,r,i,s,o){var u=p?p+e:e;if(!this._events[u])return!1;var a=this._events[u],c=arguments.length,h,l;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),c){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,r),!0;case 4:return a.fn.call(a.context,t,r,i),!0;case 5:return a.fn.call(a.context,t,r,i,s),!0;case 6:return a.fn.call(a.context,t,r,i,s,o),!0}for(l=1,h=new Array(c-1);l<c;l++)h[l-1]=arguments[l];a.fn.apply(a.context,h)}else{var A=a.length,T;for(l=0;l<A;l++)switch(a[l].once&&this.removeListener(e,a[l].fn,void 0,!0),c){case 1:a[l].fn.call(a[l].context);break;case 2:a[l].fn.call(a[l].context,t);break;case 3:a[l].fn.call(a[l].context,t,r);break;case 4:a[l].fn.call(a[l].context,t,r,i);break;default:if(!h)for(T=1,h=new Array(c-1);T<c;T++)h[T-1]=arguments[T];a[l].fn.apply(a[l].context,h)}}return!0};d.prototype.on=function(e,t,r){return Ce(this,e,t,r,!1)};d.prototype.once=function(e,t,r){return Ce(this,e,t,r,!0)};d.prototype.removeListener=function(e,t,r,i){var s=p?p+e:e;if(!this._events[s])return this;if(!t)return M(this,s),this;var o=this._events[s];if(o.fn)o.fn===t&&(!i||o.once)&&(!r||o.context===r)&&M(this,s);else{for(var u=0,a=[],c=o.length;u<c;u++)(o[u].fn!==t||i&&!o[u].once||r&&o[u].context!==r)&&a.push(o[u]);a.length?this._events[s]=a.length===1?a[0]:a:M(this,s)}return this};d.prototype.removeAllListeners=function(e){var t;return e?(t=p?p+e:e,this._events[t]&&M(this,t)):(this._events=new I,this._eventsCount=0),this};d.prototype.off=d.prototype.removeListener;d.prototype.addListener=d.prototype.on;d.prefixed=p;d.EventEmitter=d;typeof Y<"u"&&(Y.exports=d)});var $e=f((Dt,Ie)=>{"use strict";Ie.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var Le=f((zt,j)=>{"use strict";var mt=$e(),N=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Se=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(a){i(a)}return}let o=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,u=t instanceof Error?t:new N(o);typeof n.cancel=="function"&&n.cancel(),i(u)},e);mt(n.then(r,i),()=>{clearTimeout(s)})});j.exports=Se;j.exports.default=Se;j.exports.TimeoutError=N});var Oe=f(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});function _t(n,e,t){let r=0,i=n.length;for(;i>0;){let s=i/2|0,o=r+s;t(n[o],e)<=0?(r=++o,i-=s+1):i=s}return r}Q.default=_t});var Pe=f(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});var gt=Oe(),X=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let i=gt.default(this._queue,r,(s,o)=>o.priority-s.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Z.default=X});var Re=f(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});var yt=Ae(),ke=Le(),bt=Pe(),B=()=>{},wt=new ke.TimeoutError,ee=class extends yt{constructor(e){var t,r,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=B,this._resolveIdle=B,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:bt.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=B,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=B,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let o=this._timeout===void 0&&t.timeout===void 0?e():ke.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(wt)});r(await o)}catch(o){i(o)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};te.default=ee});var He=f((ar,Fe)=>{"use strict";var je=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,Be=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function At(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[i,s]of Object.entries(r))e[i]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},r[i]=e[i],n.set(s[0],s[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=je(),e.color.ansi16m=Be(),e.bgColor.ansi256=je(10),e.bgColor.ansi16m=Be(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,i)=>t===r&&r===i?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(i/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:i}=r.groups;i.length===3&&(i=i.split("").map(o=>o+o).join(""));let s=Number.parseInt(i,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(Fe,"exports",{enumerable:!0,get:At})});var Je=()=>typeof window<"u"&&typeof window.document<"u",We=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Ue=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),he=()=>typeof Deno<"u",Ke=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!he(),Ve=()=>{let n;return Je()?n="browser":Ke()?n="node":We()?n="webworker":Ue()?n="jsdom":he()?n="deno":n="other",n},W;async function de(){return W===void 0&&(W={library:"langchain-js",runtime:Ve()}),W}var Ye=Object.defineProperty,Qe=(n,e,t)=>e in n?Ye(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pe=(n,e,t)=>(Qe(n,typeof e!="symbol"?e+"":e,t),t);var ge=L(_e(),1);function st(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){let s=n.slice(t[i].start,t[i+1].end),o=e.get(s.join(","));o!=null&&(r==null||o<r[0])&&(r=[o,i])}if(r!=null){let i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function ot(n,e){return n.length===1?[e.get(n.join(","))]:st(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function at(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var K=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{let[s,o,...u]=i.split(" "),a=Number.parseInt(o,10);return u.forEach((c,h)=>r[c]=a+h),r},{});for(let[r,i]of Object.entries(t)){let s=ge.default.toByteArray(r);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,s])=>(r[s]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),i=K.specialTokenRegex(Object.keys(this.specialTokens)),s=[],o=new Set(e==="all"?Object.keys(this.specialTokens):e),u=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!o.has(c)):t);if(u.size>0){let c=K.specialTokenRegex([...u]),h=n.match(c);if(h!=null)throw new Error(`The text contains a special token that is not allowed: ${h[0]}`)}let a=0;for(;;){let c=null,h=a;for(;i.lastIndex=h,c=i.exec(n),!(c==null||o.has(c[0]));)h=c.index+1;let l=c?.index??n.length;for(let T of n.substring(a,l).matchAll(r)){let ce=this.textEncoder.encode(T[0]),le=this.rankMap.get(ce.join(","));if(le!=null){s.push(le);continue}s.push(...ot(ce,this.rankMap))}if(c==null)break;let A=this.specialTokens[c[0]];s.push(A),a=c.index+c[0].length}return s}decode(n){let e=[],t=0;for(let s=0;s<n.length;++s){let o=n[s],u=this.textMap.get(o)??this.inverseSpecialTokens[o];u!=null&&(e.push(u),t+=u.length)}let r=new Uint8Array(t),i=0;for(let s of e)r.set(s,i),i+=s.length;return this.textDecoder.decode(r)}},P=K;pe(P,"specialTokenRegex",n=>new RegExp(n.map(e=>at(e)).join("|"),"g"));function V(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-0314":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}var Me=L(Ee(),1),F=L(Re(),1),vt=[400,401,403,404,405,406,407,408,409],w=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t="default"in F.default?F.default.default:F.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Me.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt(r){if(r.message.startsWith("Cancel")||r.message.startsWith("TimeoutError")||r.message.startsWith("AbortError")||r?.code==="ECONNABORTED")throw r;let i=r?.response?.status;if(i&&vt.includes(+i))throw r},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}};var H={},xt=new w({});async function Tt(n,e){return n in H||(H[n]=xt.fetch(`https://tiktoken.pages.dev/js/${n}.json`,{signal:e?.signal}).then(t=>t.json()).catch(t=>{throw delete H[n],t})),new P(await H[n],e?.extendedSpecialTokens)}async function q(n,e){return Tt(V(n),e)}var re=n=>n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k-")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n;var Et=n=>{switch(re(n)){case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}},Xt=async({prompt:n,modelName:e})=>{let t=Math.ceil(n.length/4);try{t=(await q(e)).encode(n).length}catch{}return Et(e)-t};var Ct=()=>!1,ne=class{constructor(e){Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Ct(),this.callbacks=e.callbacks}},Ne=class extends ne{get callKeys(){return["stop","timeout","signal"]}constructor(e){super({verbose:e.verbose,callbacks:e.callbacks??e.callbackManager}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new w(e??{})}async getNumTokens(e){let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await q("modelName"in this?re(this.modelName):"gpt2")}catch{}return this._encoding&&(t=this._encoding.encode(e).length),t}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){let{_type:t,_model:r,...i}=e;if(r&&r!=="base_chat_model")throw new Error(`Cannot load LLM with model ${r}`);let s={openai:(await import("./ZOQYAMTD.js")).ChatOpenAI}[t];if(s===void 0)throw new Error(`Cannot load  LLM with type ${t}`);return new s(i)}};function D(n,e="Human",t="AI"){let r=[];for(let i of n){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i}`);r.push(`${s}: ${i.text}`)}return r.join(`
`)}var ie=class{},y=class extends ie{constructor(e){super(),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent)}copy(){return new this.constructor(this)}static fromMethods(e){class t extends y{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:b()}),Object.assign(this,e)}}return new t}};var se=L(He(),1);var v=class extends y{constructor(){super(),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}_addChildRun(e,t){e.child_runs.push(t)}_startTrace(e){if(e.parent_run_id!==void 0){let t=this.runMap.get(e.parent_run_id);t&&this._addChildRun(t,e)}this.runMap.set(e.id,e)}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id)}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,i,s){let o=this._getExecutionOrder(i),u={id:r,name:e.name,parent_run_id:i,start_time:Date.now(),end_time:0,serialized:e,inputs:{prompts:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:s};this._startTrace(u),await this.onLLMStart?.(u)}async handleChatModelStart(e,t,r,i,s){let o=this._getExecutionOrder(i),u={id:r,name:e.name,parent_run_id:i,start_time:Date.now(),end_time:0,serialized:e,inputs:{messages:t},execution_order:o,child_runs:[],child_execution_order:o,run_type:"llm",extra:s};this._startTrace(u),await this.onLLMStart?.(u)}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.outputs=e,await this.onLLMEnd?.(r),await this._endTrace(r)}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");r.end_time=Date.now(),r.error=e.message,await this.onLLMError?.(r),await this._endTrace(r)}async handleChainStart(e,t,r,i){let s=this._getExecutionOrder(i),o={id:r,name:e.name,parent_run_id:i,start_time:Date.now(),end_time:0,serialized:e,inputs:t,execution_order:s,child_execution_order:s,run_type:"chain",child_runs:[]};this._startTrace(o),await this.onChainStart?.(o)}async handleChainEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.outputs=e,await this.onChainEnd?.(r),await this._endTrace(r)}async handleChainError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")throw new Error("No chain run to end.");r.end_time=Date.now(),r.error=e.message,await this.onChainError?.(r),await this._endTrace(r)}async handleToolStart(e,t,r,i){let s=this._getExecutionOrder(i),o={id:r,name:e.name,parent_run_id:i,start_time:Date.now(),end_time:0,serialized:e,inputs:{input:t},execution_order:s,child_execution_order:s,run_type:"tool",child_runs:[]};this._startTrace(o),await this.onToolStart?.(o)}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.outputs={output:e},await this.onToolEnd?.(r),await this._endTrace(r)}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");r.end_time=Date.now(),r.error=e.message,await this.onToolError?.(r),await this._endTrace(r)}async handleAgentAction(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let i=r;i.actions=i.actions||[],i.actions.push(e),await this.onAgentAction?.(r)}};function qe(n,e){return`${n.open}${e}${n.close}`}var{color:It}=se.default,$=class extends v{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((i,s,o)=>{let u=`${i.execution_order}:${i.run_type}:${i.name}`;return s===o.length-1?qe(se.default.bold,u):u}).join(" > ");return qe(It.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e)}onChainEnd(e){let t=this.getBreadcrumbs(e)}onChainError(e){let t=this.getBreadcrumbs(e)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs}onLLMEnd(e){let t=this.getBreadcrumbs(e)}onLLMError(e){let t=this.getBreadcrumbs(e)}onToolStart(e){let t=this.getBreadcrumbs(e)}onToolEnd(e){let t=this.getBreadcrumbs(e)}onToolError(e){let t=this.getBreadcrumbs(e)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e)}};var z=class extends v{constructor({exampleId:e,tenantId:t,sessionName:r,sessionExtra:i,callerParams:s}={}){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(typeof process<"u"?process.env?.LANGCHAIN_ENDPOINT:void 0)||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"sessionName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sessionExtra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tenantId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof process<"u"&&process.env?.LANGCHAIN_API_KEY&&(this.headers["x-api-key"]=process.env?.LANGCHAIN_API_KEY),this.tenantId=t??(typeof process<"u"?process.env?.LANGCHAIN_TENANT_ID:void 0),this.sessionName=r??(typeof process<"u"?process.env?.LANGCHAIN_SESSION:void 0)??"default",this.sessionExtra=i,this.exampleId=e,this.caller=new w(s??{})}async ensureSession(){if(this.session)return this.session;let e=await this.ensureTenantId(),t=`${this.endpoint}/sessions?upsert=true`,r=await this.caller.call(fetch,t,{method:"POST",headers:this.headers,body:JSON.stringify({name:this.sessionName,tenant_id:e,extra:this.sessionExtra})});if(!r.ok){let s=await r.text();throw new Error(`Failed to create session: ${r.status} ${r.statusText} ${s}`)}let i=await r.json();return this.session=i,i}async ensureTenantId(){if(this.tenantId)return this.tenantId;let e=`${this.endpoint}/tenants`,t=await this.caller.call(fetch,e,{method:"GET",headers:this.headers});if(!t.ok){let s=await t.text();throw new Error(`Failed to fetch tenant ID: ${t.status} ${t.statusText} ${s}`)}let r=await t.json();if(!r||r.length===0)throw new Error(`No tenants found for endpoint ${e}`);let i=r[0].id;return this.tenantId=i,i}async _convertToCreate(e,t=void 0){let r=await this.ensureSession(),i=e.extra??{};return i.runtime=await de(),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:t,extra:i,execution_order:e.execution_order,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs??{},session_id:r.id,child_runs:await Promise.all(e.child_runs.map(o=>this._convertToCreate(o)))}}async persistRun(e){let t=await this._convertToCreate(e,this.exampleId),r=`${this.endpoint}/runs`,i=await this.caller.call(fetch,r,{method:"POST",headers:this.headers,body:JSON.stringify(t)});if(!i.ok){let s=await i.text();throw new Error(`Failed to persist run: ${i.status} ${i.statusText} ${s}`)}}};var G=class extends v{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:(typeof process<"u"?process.env?.LANGCHAIN_ENDPOINT:void 0)||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof process<"u"&&process.env?.LANGCHAIN_API_KEY&&(this.headers["x-api-key"]=process.env?.LANGCHAIN_API_KEY)}async newSession(e){let t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){let t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){let e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){let t=this.session??await this.loadDefaultSession(),r=e.serialized,i;if(e.run_type==="llm"){let s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>D(u));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:s,response:e.outputs}}else if(e.run_type==="chain"){let s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){let s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:e.outputs?.output,action:JSON.stringify(r),child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return i}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`,(await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)})).ok}async persistSession(e){let t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:{id:1,...e}}async _handleSessionResponse(e){let t=await fetch(e,{method:"GET",headers:this.headers}),r;if(!t.ok)return r={id:1,start_time:Date.now()},this.session=r,r;let i=await t.json();return i.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=i,this.session=r,r)}};async function De(n){let e=new G;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function ze(){return new z}var oe=class{setHandler(e){return this.setHandlers([e])}},S=class{constructor(e,t,r,i){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:i})}async handleText(e){await Promise.all(this.handlers.map(async t=>{try{await t.handleText?.(e,this.runId,this._parentRunId)}catch{}}))}},J=class extends S{async handleLLMNewToken(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreLLM)try{await t.handleLLMNewToken?.(e,this.runId,this._parentRunId)}catch{}}))}async handleLLMError(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId)}catch{}}))}async handleLLMEnd(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId)}catch{}}))}},ae=class extends S{getChild(){let e=new x(this.runId);return e.setHandlers(this.inheritableHandlers),e}async handleChainError(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId)}catch{}}))}async handleChainEnd(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId)}catch{}}))}async handleAgentAction(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId)}catch{}}))}async handleAgentEnd(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId)}catch{}}))}},ue=class extends S{getChild(){let e=new x(this.runId);return e.setHandlers(this.inheritableHandlers),e}async handleToolError(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId)}catch{}}))}async handleToolEnd(e){await Promise.all(this.handlers.map(async t=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId)}catch{}}))}},x=class extends oe{constructor(e){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=[],this.inheritableHandlers=[],this._parentRunId=e}async handleLLMStart(e,t,r=b(),i=void 0,s=void 0){return await Promise.all(this.handlers.map(async o=>{if(!o.ignoreLLM)try{await o.handleLLMStart?.(e,t,r,this._parentRunId,s)}catch{}})),new J(r,this.handlers,this.inheritableHandlers,this._parentRunId)}async handleChatModelStart(e,t,r=b(),i=void 0,s=void 0){let o;return await Promise.all(this.handlers.map(async u=>{if(!u.ignoreLLM)try{u.handleChatModelStart?await u.handleChatModelStart?.(e,t,r,this._parentRunId,s):u.handleLLMStart&&(o=t.map(a=>D(a)),await u.handleLLMStart?.(e,o,r,this._parentRunId,s))}catch{}})),new J(r,this.handlers,this.inheritableHandlers,this._parentRunId)}async handleChainStart(e,t,r=b()){return await Promise.all(this.handlers.map(async i=>{if(!i.ignoreChain)try{await i.handleChainStart?.(e,t,r,this._parentRunId)}catch{}})),new ae(r,this.handlers,this.inheritableHandlers,this._parentRunId)}async handleToolStart(e,t,r=b()){return await Promise.all(this.handlers.map(async i=>{if(!i.ignoreAgent)try{await i.handleToolStart?.(e,t,r,this._parentRunId)}catch{}})),new ue(r,this.handlers,this.inheritableHandlers,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}copy(e=[],t=!0){let r=new x(this._parentRunId);for(let i of this.handlers){let s=this.inheritableHandlers.includes(i);r.addHandler(i,s)}for(let i of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends y{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:b()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r){let i;(e||t)&&(Array.isArray(e)||!e?(i=new x,i.setHandlers(e?.map(Ge)??[],!0)):i=e,i=i.copy(Array.isArray(t)?t.map(Ge):t?.handlers,!1));let s=(typeof process<"u"?process.env?.LANGCHAIN_VERBOSE!==void 0:!1)||r?.verbose,o=typeof process<"u"?process.env?.LANGCHAIN_TRACING_V2!==void 0:!1,u=o||(typeof process<"u"?process.env?.LANGCHAIN_TRACING!==void 0:!1);if(s||u){if(i||(i=new x),s&&!i.handlers.some(a=>a.name===$.prototype.name)){let a=new $;i.addHandler(a,!0)}if(u&&!i.handlers.some(a=>a.name==="langchain_tracer"))if(o)i.addHandler(await ze(),!0);else{let a=typeof process<"u"?process.env?.LANGCHAIN_SESSION:void 0;i.addHandler(await De(a),!0)}}return i}};function Ge(n){return"name"in n?n:y.fromMethods(n)}export{Ke as a,re as b,Xt as c,D as d,x as e,ne as f,Ne as g};
