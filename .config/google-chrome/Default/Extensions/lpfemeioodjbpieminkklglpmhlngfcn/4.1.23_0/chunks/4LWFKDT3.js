import{a as E}from"./RBW4HNBE.js";import{a as f}from"./MM6H3LLZ.js";import{h as i}from"./GDFJJHFX.js";import{a as u}from"./42TZCCKB.js";import{f as c}from"./UTGLRY7A.js";var p=c(u());var o="USECHATGPT_AUTH_INFO_STORAGE_KEY_20230829";var n={new_user:0,old_free_user:0,pro_gift:0,free:0,pro:1,elite:2};var a=c(f());var R={GET_USER_INFO:"/user/get_user_info",TWITTER_SHARE_COMPLETE:"/user/twitter_share_complete",TWITTER_FOLLOWING_COMPLETE:"/user/twitter_following_complete",GET_REFERRAL_DASHBOARD:"/user/get_referral_dashboard",SAVE_TWITTER_SCREEN_NAME:"/user/save_twitter_screen_name",GET_TWITTER_REFERRAL_TASKS_STATUS:"/user/get_twitter_referral_tasks_status",GET_USER_SUBSCRIPTION_INFO:"/user/get_user_subscription_info"},U={GET_FAVOURITE_PROMPTS:"/prompt/get_favourite_prompts",GET_OWN_PROMPTS:"/prompt/get_own_prompts",SEARCH_PROMPT:"/prompt/search_prompt",GET_PROMPT_DETAIL:"/prompt/get_prompt_detail",GET_PRIVATE_PROMPT_DETAIL:"/prompt/get_private_prompt_detail",PROMPT_CATEGORY:"/prompt/category",ADD_PROMPT:"/prompt/add_own_prompt",ADD_FAVOURITE_PROMPT:"/prompt/add_favourite_prompt",REMOVE_FAVOURITE_PROMPT:"/prompt/remove_favourite_prompt",DELETE_PROMPT:"/prompt/remove_own_prompt",EDIT_OWN_PROMPT:"/prompt/update_own_prompt"};var w=()=>{try{let e=window.localStorage.getItem("UseChatGPTAuthServiceProvider.email"),r=`UseChatGPTAuthServiceProvider.${e}`,s=window.localStorage.getItem(r+".accessToken"),t=window.localStorage.getItem(r+".refreshToken");return t?{accessToken:s,refreshToken:t,email:e}:null}catch{return null}},m=async()=>{let e=await p.default.storage.local.get(o);return e[o]?e[o]?.refreshToken:""},G=async()=>{let e=await p.default.storage.local.get(o);return e[o]?e[o]?.userInfo:null},C=async()=>(await new E({runtime:"client"}).postMessage({event:"Client_logoutUseChatGPTAuth"})).success,y=async()=>{try{let e=await m();if(!e)return;let r=await fetch(`${i}${R.GET_USER_SUBSCRIPTION_INFO}`,{headers:{Authorization:`Bearer ${e}`}});if(r.ok){let s=await r.json();if(s.status==="OK"&&s.data)return s.data}return}catch{return}},N=e=>{let t=[...e.roles??[]].sort((_,T)=>(n[T.name]||0)-(n[_.name]||0))?.[0].name||"free",l=!1;if(e?.chatgpt_expires_at&&t==="free"&&new Date(e.chatgpt_expires_at).getTime()>new Date().getTime()&&(t="pro_gift"),t==="free"&&e?.created_at){let _=(0,a.default)(e?.created_at);(0,a.default)().utc().diff(_,"day")<=-1e5&&(t="new_user",l=!0)}return t};export{o as a,U as b,w as c,m as d,G as e,C as f,y as g,N as h};
