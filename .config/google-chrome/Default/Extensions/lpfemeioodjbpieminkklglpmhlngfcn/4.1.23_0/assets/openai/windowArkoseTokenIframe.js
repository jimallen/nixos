import{a as n}from"../../chunks/WZHIWEFG.js";import"../../chunks/UTGLRY7A.js";var i=class{model;apiLink;enforcement;pendingPromises=[];cacheToken="";isReady;config;constructor(e,t){this.isReady=!1,this.model=e,this.apiLink=t,this.enforcement=void 0,this.pendingPromises=[],this.model==="gpt_3_5"?window.useArkoseSetupEnforcementgpt35=this.useArkoseSetupEnforcement.bind(this):this.model==="gpt_4"&&(window.useArkoseSetupEnforcementgpt4=this.useArkoseSetupEnforcement.bind(this)),this.injectScript()}useArkoseSetupEnforcement(e){this.enforcement=e,e.setConfig({onCompleted:t=>{this.pendingPromises.length===0&&(this.cacheToken=t.token),this.pendingPromises.forEach(o=>{o.resolve(t.token)}),this.pendingPromises=[]},onReady:()=>{this.isReady=!0,e.run()},onError:t=>{},onFailed:t=>{this.pendingPromises.forEach(o=>{o.reject(new Error("Failed to generate arkose token"))})}})}injectScript(){let e=document.createElement("script");this.model==="gpt_3_5"?(e.src=this.apiLink,e.setAttribute("data-callback","useArkoseSetupEnforcementgpt35"),e.setAttribute("data-status","loading")):this.model==="gpt_4"&&(e.src=this.apiLink,e.setAttribute("data-callback","useArkoseSetupEnforcementgpt4"),e.setAttribute("data-status","loading")),document.body.appendChild(e)}async generate(){if(!this.enforcement)return"";if(this.cacheToken){let e=this.cacheToken;return this.cacheToken="",e}return new Promise((e,t)=>{this.pendingPromises=[{resolve:e,reject:t}],this.enforcement?.run()})}},r=document.querySelector("script[data-arkose_token_gpt_3_5]")?.getAttribute("data-arkose_token_gpt_3_5"),a=document.querySelector("script[data-arkose_token_gpt_4]")?.getAttribute("data-arkose_token_gpt_4");if(r&&a){let s=new i("gpt_3_5",r),e=new i("gpt_4",a);for(let t=0;t<7&&!(s.isReady||e.isReady);t++)await new Promise(o=>setTimeout(o,1e3));s.isReady||e.isReady?(window.parent.postMessage({id:n,type:"inject_iframe_response",data:{success:!0}},"*"),window.addEventListener("message",async t=>{if(t.data&&t.data.id===n){let o=t.data?.data?.model||"gpt_3_5";if(t.data.type==="ping")t.source.postMessage({type:"pong",id:n,data:{success:o==="gpt_3_5"?s.isReady:e.isReady}},t.origin);else if(t.data.type==="get_token"){let c=o==="gpt_3_5"?s:e,d=await Promise.race([e.generate(),s.generate()]);t.source.postMessage({type:"get_token_response",id:n,data:{token:d}},t.origin)}}})):window.parent.postMessage({id:n,type:"inject_iframe_response",data:{success:!1}},"*")}
