import{A as Z,B as S,c as X,d as q,e as j,f as $,s as z,t as J,u as _,w as x,x as Y,z as M}from"../chunks/LW25NQB3.js";import{g as B}from"../chunks/GD5QHANB.js";import{b as at}from"../chunks/OPD7L36E.js";import{X as K}from"../chunks/HIM55SOL.js";import{a as k}from"../chunks/X2SRSDMC.js";import"../chunks/CUN77TMN.js";import{a as V}from"../chunks/ECZ75PXO.js";import{a as m,c as W,d as H}from"../chunks/UPAMUR3A.js";import"../chunks/4LWFKDT3.js";import{a as p}from"../chunks/USLLVG5P.js";import{h as T,j as tt,k as et}from"../chunks/M4D57PBX.js";import"../chunks/ZO2DK75M.js";import"../chunks/6SFGN2RQ.js";import"../chunks/BDDH5KT2.js";import{j as E}from"../chunks/TPJJPVCY.js";import"../chunks/SZ3C6HJE.js";import"../chunks/RBW4HNBE.js";import"../chunks/MM6H3LLZ.js";import{c as d,j as b,r as g}from"../chunks/GDFJJHFX.js";import{a as A}from"../chunks/42TZCCKB.js";import"../chunks/GVJKCNTM.js";import{f as I}from"../chunks/UTGLRY7A.js";var st=()=>{m(async(r,t,e,a)=>{if(r==="shortcut")switch(t){case"ShortCuts_getContentOfURL":{let{URL:s,timeOut:n,withSnapshot:i}=e,o=await k(X(s,"",i),n??999999,{title:"",body:"",url:s,success:!1});return{data:o,success:o.success,message:"ok"}}case"ShortCuts_getHtmlOfURL":{let{URL:s}=e,n=await j(s);return{data:n,success:n.success,message:"ok"}}case"ShortCuts_getContentOfSearchEngine":{let{URL:s,proxyFetch:n}=e,i=await q(s,n);return{data:i,success:i.success,message:"ok"}}default:break}})};var C=I(A());var rt=()=>{m(async(r,t,e,a)=>{if(r==="client")switch(t){case"Client_logCallApiRequest":{return z(e),{success:!0,message:"ok",data:{}};break}default:break}})};var nt=I(A()),f=class{bardChat;constructor(t){this.bardChat=t}async auth(t){await this.bardChat.auth()}async preAuth(){await this.bardChat.checkAuth()}get status(){return this.bardChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(t){return await this.bardChat.reset(),Promise.resolve(!0)}sendQuestion=async(t,e,a,s)=>{let n=p();await this.bardChat.askChatGPT(a.question,{taskId:a.messageId,regenerate:s.regenerate,include_history:s.includeHistory,max_history_message_cnt:s.maxHistoryMessageCnt},async({type:i,done:o,error:u,data:c})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:c.text,parentMessageId:a.messageId,conversationId:c.conversationId,messageId:n},error:u,done:o})})};async abortAskQuestion(t){return await this.bardChat.abortTask(t)}async destroy(){await this.bardChat.destroy()}async sendResponseToClient(t,e){await nt.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var it=I(A()),y=class{bingChat;constructor(t){this.bingChat=t}async auth(t){await this.bingChat.auth()}async preAuth(){await this.bingChat.auth()}get status(){return this.bingChat.status}async createConversation(){return Promise.resolve("")}async removeConversation(t){return await this.bingChat.removeConversation(t),Promise.resolve(!0)}sendQuestion=async(t,e,a,s)=>{let n=p();await this.bingChat.askChatGPT(a.question,{taskId:a.messageId,regenerate:s.regenerate,include_history:s.includeHistory,max_history_message_cnt:s.maxHistoryMessageCnt,clientTabId:e?.tab?.id},async({type:i,done:o,error:u,data:c})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:c.text,parentMessageId:a.messageId,conversationId:c.conversationId,messageId:n},error:u,done:o})})};async abortAskQuestion(t){return await this.bingChat.abortTask(t)}async destroy(){await this.bingChat.destroy()}async sendResponseToClient(t,e){await it.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var h=class{chatAdapter;constructor(t){this.chatAdapter=t}async preAuth(){await this.chatAdapter.preAuth()}async auth(t){await this.chatAdapter.auth(t)}get status(){return this.chatAdapter.status}sendQuestion=(t,e,a,s)=>this.chatAdapter.sendQuestion(t,e,a,s);async abortAskQuestion(t){return await this.chatAdapter.abortAskQuestion(t)}async destroy(){await this.chatAdapter.destroy()}async createConversation(){return await this.chatAdapter.createConversation()}async removeConversation(t){return await this.chatAdapter.removeConversation(t)}};var ot=I(A()),v=class{claudeChat;constructor(t){this.claudeChat=t}async auth(t){await this.claudeChat.auth()}async preAuth(){await this.claudeChat.preAuth()}get status(){return this.claudeChat.status}async createConversation(){return await this.claudeChat.createConversation()}async removeConversation(t){return await this.claudeChat.removeConversation(t),Promise.resolve(!0)}sendQuestion=async(t,e,a,s)=>{let n=p();await this.claudeChat.askChatGPT(a.question,{taskId:a.messageId,regenerate:s.regenerate,include_history:s.includeHistory,max_history_message_cnt:s.maxHistoryMessageCnt},async({type:i,done:o,error:u,data:c})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:c.text,parentMessageId:a.messageId,conversationId:c.conversationId,messageId:n},error:u,done:o})})};async abortAskQuestion(t){return await this.claudeChat.abortTask(t)}async destroy(){await this.claudeChat.destroy()}async sendResponseToClient(t,e){await ot.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var ct=I(A()),w=class{openAIChat;constructor(t){this.openAIChat=t}async preAuth(){return this.openAIChat.preAuth()}async auth(t){await this.openAIChat.auth(t)}get status(){return this.openAIChat.status}sendQuestion=async(t,e,a,s)=>{let n=p();await this.openAIChat.askChatGPT(a.question,{taskId:a.messageId,regenerate:s.regenerate,include_history:s.includeHistory,max_history_message_cnt:s.maxHistoryMessageCnt,newConversation:!!s.meta?.newConversation},async({type:i,done:o,error:u,data:c})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:c.text,parentMessageId:a.messageId,conversationId:c.conversationId,messageId:n},error:u,done:o})})};async abortAskQuestion(t){try{return await this.openAIChat.abortAskQuestion(t),!0}catch{return!1}}async createConversation(){let t=await this.openAIChat.createConversation();return t&&t.conversationId?t.conversationId:Promise.resolve("")}async removeConversation(t){return await this.openAIChat.removeConversation(t)}destroy(){return this.openAIChat.destroy()}async sendResponseToClient(t,e){await ct.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var l=I(A()),ut=()=>{let r=E();m(async(t,e,a,s)=>{if(t==="client")switch(e){case"Client_openUrl":{let{url:n,key:i,query:o=""}=a;if(n)return await l.default.tabs.create({url:n}),{data:!0,success:!0,message:"ok"};if(i){if(i==="current_page")s.tab?.id&&await l.default.tabs.update(s.tab.id,{active:!0});else if(i==="shortcuts")r?await l.default.runtime.openOptionsPage():await l.default.tabs.create({url:"chrome://extensions/shortcuts",active:!0});else if(i==="options")r?await l.default.runtime.openOptionsPage():await H(o);else if(i==="manage_extension")if(r)await l.default.runtime.openOptionsPage();else{let u="chrome://extensions";await l.default.tabs.create({url:`${u}${o?`?${o}`:""}`,active:!0})}return{data:!0,success:!0,message:"ok"}}}break;case"Client_restartApp":return await W(),{data:!0,success:!0,message:"ok"};case"Client_getChromeExtensionCommands":return{data:await l.default.commands.getAll()||[],success:!0,message:"ok"};case"Client_getTabInfo":{let n=s.tab;return s.tab?.id||(n=(await l.default.tabs.query({active:!0,currentWindow:!0}))[0]),{data:n,success:!0,message:"ok"}}break;default:break}})};var ht=()=>{m(async(r,t,e,a)=>{if(r==="client")switch(t){case"Requester_proxyFetch":return await V.fetch(e.url,e.options,e.proxySettings);default:break}})};var dt=()=>{m(async(r,t,e,a)=>{if(r==="client")switch(t){case"LarkBot_sendMessage":{return await K(e.title,e.message,e.attr),{success:!0,message:"ok",data:{}};break}default:break}})};var mt=I(A());var G=class{maxAIClaudeChat;constructor(t){this.maxAIClaudeChat=t}async auth(t){await this.maxAIClaudeChat.auth(t)}async preAuth(){await this.maxAIClaudeChat.preAuth()}get status(){return this.maxAIClaudeChat.status}async createConversation(){return await this.maxAIClaudeChat.createConversation()}async removeConversation(t){return await this.maxAIClaudeChat.removeConversation(),Promise.resolve(!0)}sendQuestion=async(t,e,a,s)=>{let n=p();await this.maxAIClaudeChat.askChatGPT(a.question,{taskId:a.messageId,regenerate:s.regenerate,streaming:s.meta?.streaming},async({type:i,done:o,error:u,data:c})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:c.text,parentMessageId:a.messageId,conversationId:c.conversationId,messageId:n},error:u,done:o})})};async abortAskQuestion(t){return await this.maxAIClaudeChat.abortTask(t)}async destroy(){await this.maxAIClaudeChat.destroy()}async sendResponseToClient(t,e){await mt.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var pt=I(A());var O=class{useChatGPTPlusChat;constructor(t){this.useChatGPTPlusChat=t}async auth(t){await this.useChatGPTPlusChat.auth(t)}async preAuth(){await this.useChatGPTPlusChat.preAuth()}get status(){return this.useChatGPTPlusChat.status}async createConversation(){return await this.useChatGPTPlusChat.createConversation()}async removeConversation(t){return await this.useChatGPTPlusChat.removeConversation(),Promise.resolve(!0)}sendQuestion=async(t,e,a,s)=>{let n=p(),i=[];await this.useChatGPTPlusChat.askChatGPT(a.question,{backendAPI:"get_chatgpt_response",taskId:a.messageId,chat_history:i,streaming:s.meta?.streaming},async({type:o,done:u,error:c,data:U})=>{e.tab?.id&&await this.sendResponseToClient(e.tab.id,{taskId:t,data:{text:U.text,parentMessageId:a.messageId,conversationId:U.conversationId,messageId:n},error:c,done:u})})};async abortAskQuestion(t){return await this.useChatGPTPlusChat.abortTask(t)}async destroy(){await this.useChatGPTPlusChat.destroy()}async sendResponseToClient(t,e){await pt.default.tabs.sendMessage(t,{id:d,event:"Client_askChatGPTQuestionResponse",data:e})}};var Ct=()=>{let r=new h(new w(new M)),t=new h(new f(new _)),e=new h(new y(new x)),a=new h(new v(new S));return{[T.OPENAI]:r,[T.BARD]:t,[T.BING]:e,[T.CLAUDE]:a}};var L=class{currentProvider;conversationId;adapters={};constructor(){this.adapters=Ct(),this.initChatSystem(),tt().then(t=>{this.currentProvider=t.aiProvider})}get currentAdapter(){return this.currentProvider?this.adapters[this.currentProvider]:void 0}initChatSystem(){m(async(t,e,a,s)=>{if(t==="client")switch(e){case"SWAI_switchAIProvider":{let{provider:n}=a;return await this.switchAdapter(n),await this.preAuth(),{success:!0,data:n,message:""};break}case"SWAI_askAIQuestion":{await this.auth(s.tab?.id||0),this.conversationId&&await this.removeConversation(this.conversationId);let n=a.taskId,i=a.question,o=a.options,u=await this.createConversation();o.meta={newConversation:!0},this.conversationId=u,await this.sendQuestion(n,s,i,o);break}case"SWAI_abortAskChatGPTQuestion":{let{taskId:n}=a;return await this.abortAskQuestion(n),{success:!0,data:{},message:""}}case"SWAI_getConversationId":return{success:!0,data:{conversationId:this.conversationId},message:""};default:break}})}async switchAdapter(t){return await this.destroy(),this.currentProvider=t,await et({aiProvider:t}),this.currentAdapter}async auth(t){this.currentAdapter&&await this.currentAdapter.auth(t)}async preAuth(){this.currentAdapter&&await this.currentAdapter.preAuth()}sendQuestion=(t,e,a,s)=>this.currentAdapter?.sendQuestion(t,e,a,s)||Promise.resolve();async abortAskQuestion(t){return this.currentAdapter?await this.currentAdapter.abortAskQuestion(t):!1}async createConversation(t){return this.currentAdapter&&await this.currentAdapter?.createConversation(t)||""}async removeConversation(t){return!this.currentAdapter||!t?!1:await this.currentAdapter?.removeConversation(t)}async destroy(){await this.currentAdapter?.removeConversation(""),await this.currentAdapter?.destroy()}},It=L;var At=()=>{new It};var Q=I(A());var lt=b?"mhnlakgilnojmhinhkckjpncpbhabphi":"ohcocpchbbkihblfnkkcpmkdkmabdjbm",gt="https://app.maxai.me/anniversary2024_webchatgpt";var N=I(A()),R="PROMOTION_ALERT_FLAG_4_1_23",ft=0,D=async()=>{let r=await N.default.storage.local.get(R);return r[R]?Number(r[R]):ft},vt=async r=>{await N.default.storage.local.set({[R]:r})},yt=async()=>{let r=await D()||ft;await vt(r+1)};Q.default.runtime.onInstalled.addListener(async r=>{await D()<1&&r.reason==="update"&&((await k(Q.default.runtime.sendMessage(lt,{event:"GET_MAXAI_USERINFO"}),5e3,{isLogin:!1,success:!1}))?.success||(await yt(),Q.default.tabs.create({url:gt,active:!0})))});var wt=E();C.default.runtime.onInstalled.addListener(async r=>{r.reason==="install"&&(F(),Pt())});C.default.runtime.setUninstallURL("https://tools.zmo.ai/webchatgpt/uninstall?from=crx");function F(){b?C.default.tabs.create({url:"https://chat.openai.com"}):C.default.runtime.openOptionsPage()}function Pt(){C.default.tabs.create({active:!1,url:"https://tools.zmo.ai/webchatgpt/install"})}wt?C.default.browserAction.onClicked.addListener(F):C.default.action.onClicked.addListener(F);C.default.commands.onCommand.addListener(async r=>{r==="toggle-web-access"&&C.default.tabs.query({active:!0,currentWindow:!0}).then(t=>{let e=t[0];e.url&&e.id&&e.url.startsWith("https://chat.openai.com/")&&C.default.tabs.sendMessage(e.id,{id:d,event:"Client_ToggleWebAccess"})})});C.default.tabs.onUpdated.addListener(async(r,t,e)=>{t.status==="complete"&&e.url&&e.url.includes("google")&&B()});b&&B();ut();st();$();rt();ht();dt();at();var P=new Y,bt=new h(new w(new M)),Tt=new h(new f(new _)),kt=new h(new y(new x)),_t=new h(new v(new S)),xt=new h(new G(new Z)),Mt=new h(new O(new J));P.addAdapter(g.OPENAI,bt);P.addAdapter(g.BING,kt);P.addAdapter(g.BARD,Tt);P.addAdapter(g.CLAUDE,_t);P.addAdapter(g.MAXAI_CLAUDE,xt);P.addAdapter(g.USE_CHAT_GPT_PLUS,Mt);At();
