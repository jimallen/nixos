!function(){function t(t){return new Promise((e=>setTimeout(e,t)))}function e(){let t,e;return{promise:new Promise(((n,o)=>{t=n,e=o})),resolve:t,reject:e}}class n extends Error{}function o(t){return new Promise(((e,o)=>setTimeout((()=>o(new n("Promise timed out."))),t)))}class r extends Error{constructor(t){super(`Matching not exhaustive: unexpected value ${JSON.stringify(t)}`)}}async function i(e,n,o){const r=o();if(!(e>0))return r;try{return await r}catch(r){return await t(n),i(e-1,n,o)}}var s;!function(t){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}t.create=function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(s||(s={}));void 0!==self.requestIdleCallback&&self.requestIdleCallback;var a;!function(n){class o extends Error{constructor(t,e=1e3){super(`SafePromiseError: ${t}`),this.stack=(super.stack||"").slice(e)}}function r(t){return t.catch((t=>t instanceof Error&&!t.stack?Promise.reject(new o(t.message)):Promise.reject(t)))}n.fromPromise=r,n.fromAsync=function(t){return(...e)=>r(t(...e))},n.noop=n.fromPromise(Promise.resolve()),n.create=function(t){return r(new Promise(t))},n.sync=function(t){return r(new Promise(((e,n)=>e(t()))))},n.createCompletionSource=e,n.delay=t}(a||(a={}));class l{constructor(t,e){this._transport=t,this._log=e,this._calls=new Map,this._sub=this._transport.inbound.subscribe((t=>{var e;const n=this._calls.get(t.id);if(n)try{"err"in t?n.reject(t.err):n.resolve(t.res)}finally{this._calls.delete(t.id)}else null===(e=this._log)||void 0===e||e.warn(`received rpc call response for unregistered call ${t.id}`)})),this.api=new Proxy({},{get:(t,e)=>"then"===e?void 0:(...t)=>this._handleCall(e,t)})}_handleCall(t,e){let n=s.create();for(;this._calls.has(n);)n=s.create();const o=a.createCompletionSource();return this._calls.set(n,o),this._transport.outbound({id:n,method:t,args:e}),o.promise}dispose(){this._sub.unsubscribe()}}class c{constructor(t,e,n,o){this._customInboundEventName=e,this._customOutboundEventName=n,this._wrapOutboundMessage=o,this.inbound={subscribe:t=>{const e=({detail:e})=>{const n=e;t&&("function"==typeof t?t(n):t.next&&t.next(n))};return this._target.addEventListener(this._customInboundEventName,e,!1),{unsubscribe:()=>this._target.removeEventListener(this._customInboundEventName,e,!1)}}},this.outbound=t=>{const e=this._wrapOutboundMessage?this._wrapOutboundMessage(t):t,n=new CustomEvent(this._customOutboundEventName,{bubbles:!0,cancelable:!0,detail:e});this._target.dispatchEvent(n)},this._target=t.defaultView||t}}const u=(t,e)=>t<e?-1:t>e?1:0;function f(t,e){const n=t.left<=e.left?t:e,o=n===t?e:t,r=t.top<=e.top?t:e,i=r===t?e:t;return n.left+n.width>o.left&&r.top+r.height>i.top}const g=(t,e)=>t.top===e.top?u(t.left,e.left):u(t.top,e.top),p=(new Set(["version","title","lang","translate","dir","dataset","hidden","tabIndex","accessKey","draggable","spellcheck","contentEditable","isContentEditable","offsetParent","offsetTop","offsetLeft","offsetWidth","offsetHeight","style","innerText","outerText","onabort","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextmenu","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onseeked","onseeking","onselect","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onwheel","ongotpointercapture","onlostpointercapture","onpointerdown","onpointermove","onpointerup","onpointercancel","onpointerover","onpointerout","onpointerenter","onpointerleave","click","focus","blur","onauxclick","nonce","namespaceURI","prefix","localName","tagName","id","className","classList","slot","attributes","shadowRoot","assignedSlot","innerHTML","outerHTML","scrollTop","scrollLeft","scrollWidth","scrollHeight","clientTop","clientLeft","clientWidth","clientHeight","onbeforecopy","onbeforecut","onbeforepaste","oncopy","oncut","onpaste","onsearch","onselectstart","previousElementSibling","nextElementSibling","children","firstElementChild","lastElementChild","childElementCount","onwebkitfullscreenchange","onwebkitfullscreenerror","setPointerCapture","releasePointerCapture","hasPointerCapture","hasAttributes","getAttributeNames","getAttribute","getAttributeNS","setAttribute","setAttributeNS","removeAttribute","removeAttributeNS","hasAttribute","hasAttributeNS","getAttributeNode","getAttributeNodeNS","setAttributeNode","setAttributeNodeNS","removeAttributeNode","closest","matches","webkitMatchesSelector","attachShadow","getElementsByTagName","getElementsByTagNameNS","getElementsByClassName","insertAdjacentElement","insertAdjacentText","insertAdjacentHTML","requestPointerLock","getClientRects","getBoundingClientRect","scrollIntoView","scrollIntoViewIfNeeded","createShadowRoot","getDestinationInsertionPoints","animate","remove","querySelector","querySelectorAll","webkitRequestFullScreen","webkitRequestFullscreen","scroll","scrollTo","scrollBy","before","after","replaceWith","prepend","append","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","nodeType","nodeName","baseURI","isConnected","ownerDocument","parentNode","parentElement","childNodes","firstChild","lastChild","previousSibling","nextSibling","nodeValue","textContent","hasChildNodes","getRootNode","normalize","cloneNode","isEqualNode","isSameNode","compareDocumentPosition","contains","lookupPrefix","lookupNamespaceURI","isDefaultNamespace","insertBefore","appendChild","replaceChild","removeChild","addEventListener","removeEventListener","dispatchEvent"]),[61439,61438,59651,26,30,59649,3,59653,59652,16,17]),d=[61439,61438,59651,26,30,59649,3,59653,59652,16,17,60417,60416,60419,60418],h=[p,d],m=[47,91,...p,93,47],y=[47,91,...d,93,47],v=[m,[...m,103],y].map((t=>t.map((t=>String.fromCharCode(t))).join(""))),b=["rgba(118, 167, 250, 0.501960784313726)","rgba(118, 167, 250, 0.5)","rgba(143, 143, 143, 0.34)","rgba(0, 0, 0, 0.15)"].map((t=>t.replace(/\s+/g,"")));function x(t,e){let n=0,o=t.length-1;for(;n<=o;){const r=n+o>>1,i=e(t[r]);if(i>0)n=r+1;else{if(!(i<0))return{kind:"found",index:r};o=r-1}}return{kind:"notFound",lastSearchRange:[Math.min(n,o),Math.max(n,o)]}}function S(t,e,n=.001){return t===e||Math.abs(t-e)<=n}const w="text-foreground",T="equation";function E(t,e,n){const o=new DOMPoint(t,e).matrixTransform(n);return{left:o.x,top:o.y}}function C(t,e,n){return{width:n.a*t+n.c*e,height:n.b*t+n.d*e}}function M(t,e){return e.a*t}function k(t,e){return e.d*t}const R=["rgba(0,0,0,1)"];function N(t){const e=t.getRenderingPhase();if(null!==e&&e!==w)return!1;const n=t.getLayoutNodeType();return"kix-reflow-footnote"===n||(null===n||"kix-column"===n)&&void 0}var A,P,_;function O(){let t,e,n,o,r=A.INIT;const i=()=>{t=void 0,e=void 0,r=A.INIT,n=void 0,o=void 0};let s=0;return{hasEquations:()=>s>0,getEquationState:()=>({level:t,stage:r,seqIndex:n,fragmentStartIndex:o,equations:s}),onTranslate:(a,l,c,u,f)=>{if(l&&void 0!==o&&((o,i,s,a)=>o===t&&!(!e||e.x!==-s||e.y!==-a)&&n===i-1&&A.RESTORE===r)(a,c,u,f)){const t=l.fragments,e=o,n=t.length-e;if(n>0)return t.splice(e,n),i(),s++,!0}return t=a,e={x:u,y:f},o=null==l?void 0:l.fragments.length,r=A.TRANSLATE,n=c,!1},onBeforeSave:(e,o)=>{if(e===t){if(A.TRANSLATE!==r)return void i();if(void 0===n||o!==n+1)return void i();n=o,r=A.SAVE}},onAfterRestore:(e,o)=>{if(e===t){if(A.SAVE!==r)return void i();n=o,r=A.RESTORE}},onClip:()=>{i()},reset:()=>{s=0,i()}}}function I(t){return t.type===P.text}!function(t){t[t.INIT=-1]="INIT",t[t.TRANSLATE=0]="TRANSLATE",t[t.SAVE=1]="SAVE",t[t.RESTORE=2]="RESTORE"}(A||(A={})),function(t){t.text="text",t.space="space",t.lineBreak="lineBreak",t.footnoteLink="footnoteLink",t.mention="mention"}(P||(P={})),function(t){t.ordinary="ordinary",t.special="special"}(_||(_={}));function D(t,e,n){let o=0;return{call(r,i,s,a){var l;const c=a(s),u=null===(l=e.postFn)||void 0===l?void 0:l[i];if(u)try{u(r,t,s,c,o++)}catch(t){n.logException(`proxy.call.${String(i)}`,t)}return c},set(r,i,s,a){var l;o++;const c=null===(l=e.overrideSet)||void 0===l?void 0:l[i];if(c)try{const e=c(r,t,s);if(void 0!==e)return a(e)}catch(t){n.logException(`proxy.set.${String(i)}`,t)}return a(s)}}}const L="M",j=" ";function F(t){const e=/^(?:([\d\w]+) )?(?:(\w+) )?([\d.]+)px (?:['"])?([\w -]+)(?:['"])?$/.exec(t);if(e){const[t,n,o,r,i]=e;let s="400",a="normal";return n&&(isNaN(parseInt(n,10))?"italic"===n?(a="italic",s=isNaN(parseInt(o,10))?"bold"===o?"700":"400":o):s="bold"===n?"700":"400":(s=n,a=o||a)),`${s} ${a} ${parseFloat(r).toFixed(4)}px "${i}"`}return t}function G(t){if("moveTo"in t)return t.moveTo}function B(t){if("lineTo"in t)return t.lineTo}const $=t=>{if("bezierCurveTo"in t)return t.bezierCurveTo};function z(t,e,n,o,r=!1){const i=(t,e,n,o=!1)=>{t.beginPath(),t.strokeStyle=`rgba(0,0,255,${o?.05:.2})`,t.lineWidth=2,t.moveTo(e,n),t.lineTo(e,n-20),t.stroke()};t.save(),t.resetTransform(),i(t,e,n,r),o.forEach((o=>i(t,e+o,n,r))),t.restore()}const q=(t,e,n,o,r,i=0,s=!1)=>{t.save(),t.resetTransform(),t.fillStyle=`rgba(221,0,0,${s?.05:.1})`,t.fillRect(e,n,o,10),t.fillStyle=`rgba(221,0,0,${s?.4:.8})`,t.font="10px Arial",t.fillText(`${i}`,e,n+10),t.fillStyle=`rgba(0,128,221,${s?.4:.8})`,z(t,e,n,r,s),t.restore()},K=(t,e,n,o,r,i=!1)=>{t.save(),t.resetTransform(),t.fillStyle=`rgba(0,221,0,${i?.05:.1})`,t.fillRect(e,n+10,o,10),t.restore(),z(t,e,n,r,i)},W=(t,e,n,o=!1)=>{t.save(),t.resetTransform(),t.beginPath(),t.strokeStyle=`rgba(0,221,0,${o?.05:.1})`,t.lineWidth=5,t.moveTo(e+2.5,n),t.lineTo(e+2.5,n+10),t.lineTo(e-10,n+10),t.stroke(),t.restore()};function U(){const t=new Map;return{recordRendering:function(e,n,o){const r=`${e} ${null!=n?n:""} ${null!=o?o:""}`,i=t.get(r);i?i.count++:t.set(r,{method:e,renderingPhase:n,nodeType:o,count:1})},reset:function(){t.clear()},toJSON:function(){var e,n;const o={};for(const{method:r,renderingPhase:i,nodeType:s,count:a}of t.values()){const t=null!==(e=o[r])&&void 0!==e?e:o[r]={},l=null!=i?i:"<null>";(null!==(n=t[l])&&void 0!==n?n:t[l]={})[null!=s?s:"<null>"]=a}return o}}}function V(t,e){const n=e.getLayoutNodeType();if("rich-link-entity"===n||"page-count"===n)return!0;const o=(r=t).startsWith(lt)&&r.endsWith(ct);var r;return null===n||o||"docstext-line-view"!==n&&"footnote"!==n&&"reflow-page-break"!==n&&"reflow-column-sector"!==n&&n!==T&&"docstext-paragraph-view"!==n&&"reflow-column-break"!==n&&e.logError("proxy.isSpecialText",`Special text in node '${n}'`,{nodeType:n,renderingPhase:e.getRenderingPhase()}),!o}function H(t,e){if(e[0])return!1;const n=t.savableState.strokeStyle;if(!n||!function(t){return t.startsWith("rgba(")&&t.endsWith(",0.7)")}(n))return!1;const o=function(t){if(2!==t.length)return null;const e=G(t[0]);if(!e)return null;const n=B(t[1]);return n?e.top!==n.top?null:{y:e.top,left:e.left,width:n.left-e.left}:null}(t.path);if(!o)return!1;if(t.useStrikethroughFiltering){const e=t.getRenderingPhase();if(null!==e&&"text-decorations"!==e)return!1}return t.strikethroughLines.push(o),t.savableState.renderContainer&&t.savableState.renderContainer.fragments.push({type:"strikethrough",...o,unidentifiedUserColor:!J(n)}),!0}function J(t){return"rgba(19,115,51,0.7)"===t}const Y=["#ffffff","rgba(255,255,255,1)"],X=["#f1f3f4","rgba(241,243,244,1)"];function Q(t){if(t.compact)return 0;const{clips:e}=t.savableState;if(1===e.length){if(!t.currentPageMap)return 0;return Z(e[0],{...t.currentPageMap.pageAttrs.canvasBitmapSize,left:0,top:0})}if(2===e.length){const[t,n]=e;return Z(n,t)}return 0}function Z(t,e){return t.left!==e.left||t.width!==e.width?0:0===t.top&&t.height<.6666666666666666*e.height?1:t.top>e.top&&t.top>.6666666666666666*e.height?2:0}function tt(t){const e=t.getCurrentPageAttrs();if(t.matchingBroken=!1,t.footnote={footnoteLineDetected:!1},t.compact=e.isCompactLayout,t.clearedRect&&function(t,e){const{left:n,top:o,width:r,height:i}=e,s=t;return!(n<=0&&o<=0&&n+r>=s.width&&o+i>=s.height)}(e.canvasBitmapSize,t.clearedRect)){t.currentPageMap=null;const n={rect:null,fragments:[],wordCount:0};t.currentPartialMap={pageAttrs:e,rect:t.clearedRect,sections:{main:n}},t.savableState.renderContainer=t.currentPageFragment={type:"page",pageAttrs:e,partialRect:t.clearedRect,fragments:[]}}else t.currentPartialMap=null,t.currentPageMap=(n=e,{pageAttrs:{...n},sections:{main:{rect:null,fragments:[],wordCount:0},header:{rect:null,fragments:[],wordCount:0},footer:{rect:null,fragments:[],wordCount:0},footnotes:{rect:null,fragments:[],wordCount:0}}}),t.savableState.renderContainer=t.currentPageFragment={type:"page",pageAttrs:e,fragments:[]};var n}function et(t,e,n,o){const r=n.metricsMap.getMetrics(e,L),i=n.metricsMap.getMetrics(e,j);if(!r||!i)return null;return{spaceMetrics:i,top:t.top-k(r.chunk.actualBoundingBoxAscent,o),height:k(r.chunk.actualBoundingBoxAscent+r.chunk.actualBoundingBoxDescent,o)}}function nt(t,e,n,{top:o,height:r},i,s){const a=s.metricsMap.getMetrics(e,t);if(!a)return null;const l=M(a.chunk.width,i);return{baseline:n.top,top:o,left:n.left,text:t,width:l,height:r,charShifts:a.charShifts.map((t=>M(t.width,i)))}}function ot(t,e,n,o,r,i,s,a){const l=/^\d+$/.test(gt(t)),c=!a&&!l,u=et(n,e,r,i);if(c)return!0;if(l){const a=gt(t);if(s&&u&&I(s)){let t=s,l=o.fragments.length-1;for(let e=o.fragments.length-1;e>0;e--){const r=o.fragments[e];if(r.type===P.lineBreak)break;if(!(r.left>n.left)){t=r,l=e;break}}const c=Math.abs(t.height*it-u.height)<st*u.height,f=Math.abs(t.top-u.top)<u.height*st;if(c&&f){const s=nt(a,e,n,u,i,r);if(s){const e={...s,height:t.height,baseline:t.baseline,type:P.footnoteLink,class:_.ordinary,linkText:a,text:"#"};if(function(t){return t.type===P.space}(t)&&S(t.left,n.left,at))return!function(t,e,n=.001){return function(t,e,n=.001){return t>=e||t+n>=e}(e,t,n)}(t.width,s.width,at)?o.fragments.splice(l,1,e,{...t,left:t.left+s.width,width:t.width-s.width}):o.fragments.splice(l,1,e),!0;if(Math.abs(s.left-t.left-t.width)<.5*u.spaceMetrics.chunk.width)return o.fragments.splice(l+1,0,e),!0}}}}else if(a&&s&&u&&I(s)){const a=Math.abs(s.height*it-u.height)<st*u.height,l=Math.abs(s.top-u.top)<u.height*st;if(a&&l){const a=nt(gt(t),e,n,u,i,r);if(a){if(Math.abs(a.left-s.left-s.width)<.5*u.spaceMetrics.chunk.width)return o.fragments.push({...a,height:s.height,baseline:s.baseline,type:P.text,class:_.ordinary}),!0}}}return!1}const rt=1,it=.6,st=.1,at=.001,lt="‭",ct="‬",ut=[String.fromCharCode(8204),lt,ct],ft=new RegExp(`[${ut.join("")}]`,"g");function gt(t){return t.replace(ft,"")}function pt(t,e,n,o,r,i){var s,a;const l=i.getTransform(),c=E(e,n,l),u=F(null!==(s=r.savableState.font)&&void 0!==s?s:i.font),f=gt(t),g=V(t,r);if(p=r.savableState.font,d=r.savableState.strokeStyle,h=i.fillStyle,'400 14px "Google Sans"'===p&&"rgba(240,244,249,1)"===d&&"string"==typeof h&&["#1f1f1f","rgba(31,31,31,1)"].includes(h))return;var p,d,h;r.savableState.renderContainer&&f&&r.savableState.renderContainer.fragments.push({type:"text",style:u,color:"string"==typeof i.fillStyle?i.fillStyle:void 0,text:f,special:g,baseline:c.top,left:c.left,scaleX:l.a,scaleY:l.d});const m=o.fragments.length>0?o.fragments[o.fragments.length-1]:null;if(ot(t,u,c,o,r,l,m,!g))return;const y=m&&((v=m).type===P.text||v.type===P.footnoteLink)?m:null;var v,b;if(y){const t={top:y.baseline,left:y.left},e=c.left-t.left-y.width,n=r.lastTextClipsId!==r.savableState.clipsId||c.top-t.top>.2*y.height;!n&&e>rt&&(o.fragments.push({type:P.space,class:_.ordinary,baseline:c.top,left:t.left+y.width,top:y.top,width:e,height:y.height}),r.debugVizualize&&K(i,t.left+y.width,c.top,e,[])),n&&(o.fragments.push((b={baseline:y.baseline,left:y.left+y.width,top:y.top,height:y.height,width:r.lastTextWhitespaceWidth},{...b,type:P.lineBreak,class:_.ordinary})),r.debugVizualize&&W(i,y.left+y.width,y.top))}r.lastTextClipsId=r.savableState.clipsId;const x=et(c,u,r,l);if(!x)return;r.lastTextWhitespaceWidth=x.spaceMetrics.chunk.width;const S=null!==(a=f.match(/[^\s]+|\s+/g))&&void 0!==a?a:[];for(const t of S){const e=nt(t,u,c,x,l,r);if(null==e)continue;const n={type:P.text,class:_.ordinary,...e};o.fragments.push(n),r.debugVizualize&&(t.match(/^\s+$/)?K(i,c.left,c.top,n.width,n.charShifts):q(i,c.left,c.top,e.width,e.charShifts," "===t?void 0:o.wordCount++)),c.left+=n.width}}const dt={postFn:{fillText(t,e,[n,o,r,i]){e.layoutRenderingStats.recordRendering("fillText",e.getRenderingPhase(),e.getLayoutNodeType());const s=e.getRenderingPhase();if(null!==s&&s!==w)return;if(e.getLayoutNodeType()===T)return;try{const t=e.getLayoutNode();if(t&&function(t){for(let e=t;e;e=e.getParent())if("kix-code-snippet-block-view"===e.getType())return!0;return!1}(t))return}catch(t){e.logException("proxy.fillText.codeBlockFiltering",t,"Code block filtering error")}const a=function(t,e){if(t.currentPartialMap)return t.currentPartialMap.sections.main;if(!t.currentPageMap)return null;const n=t.currentPageMap.sections,o=t.footnote.footnoteLineDetected&&e>t.footnote.footnoteLinePosition.top?t.currentPageMap.sections.footnotes:t.currentPageMap.sections.main;if(t.compact)return o;switch(Q(t)){case 1:return n.header;case 2:return n.footer;default:return o}}(e,r);if(!a)return void function(t,e){!t.currentPageMap&&!t.currentPartialMap&&t.log(e,"Current page map expected")}(e,"proxy.fillText");const l=a.fragments.length>0;pt(n,o,r,a,e,t),!l&&a.fragments.length>0&&(a.rect=vt(e))},drawImage(t,e,n){e.layoutRenderingStats.recordRendering("drawImage",e.getRenderingPhase(),e.getLayoutNodeType());const o=e.savableState.renderContainer;if(o){const[e,r,i,s,a,l,c,u,f]=n,g=t.getTransform(),p=E(null!=l?l:r,null!=c?c:i,g),d=null!=u?u:s,h=null!=f?f:a,m=void 0===d||void 0===h?void 0:{width:d,height:h},y=void 0===m?{...p,width:void 0,height:void 0}:{...p,...C(m.width,m.height,g)};o.fragments.push({type:"image",rect:y})}},fillRect(t,e,[n,o,r,i]){if(e.layoutRenderingStats.recordRendering("fillRect",e.getRenderingPhase(),e.getLayoutNodeType()),function(t,e){const n=e.getRenderingPhase();if(null!==n)return"selection"===n;const o=t.fillStyle;return"string"==typeof o&&b.includes(o.replace(/\s+/g,""))}(t,e)){const s=t.getTransform(),a={...E(n,o,s),...C(r,i,s)},l=vt(e);if(!l||f(a,l)){const t=function(t,e,n){const o=x(t,(t=>{const o=n(e,t);return 0===o?-1:o}));return"found"===o.kind?o.index:o.lastSearchRange[0]<0?null:o.lastSearchRange[0]}(e.currentSelection,a,g);null===t?e.currentSelection.unshift(a):e.currentSelection.splice(t+1,0,a)}}1===e.saveCount&&null===e.currentPageFragment&&"string"==typeof t.fillStyle&&Y.includes(t.fillStyle)&&!e.savableState.clips.length&&bt(e,t,[n,o,r,i])},clearRect(t,e,n){e.savableState.clips.length||bt(e,t,n)},scale(t,e){1===e.saveCount&&null===e.currentPageFragment&&null!==e.clearedRect&&tt(e)},translate(t,e,[n,o],r,i){e.equations.onTranslate(e.saveCount,e.savableState.renderContainer,i,n,o)},save(t,e,n,o,r){e.equations.onBeforeSave(e.saveCount,r),e.saveCount++,e.savedState.push({...e.savableState})},restore(t,e,n,o,r){const i=e.savedState.pop();if(i&&(e.savableState=i),e.saveCount--,0===e.saveCount){if(e.currentPageMap&&e.currentPageFragment){const t=e.currentPageMap.pageAttrs,n=e.currentPageMap.sections,o=n.footer.rect?Math.min(t.canvasBitmapSize.height,n.footer.rect.top):t.canvasBitmapSize.height,r=e.footnote.footnoteLineDetected?e.footnote.footnoteLinePosition.top:o;n.footnotes.rect={top:r,left:0,width:t.canvasBitmapSize.width,height:o-r};const i=n.header.rect?Math.max(0,n.header.rect.top+n.header.rect.height):0;n.main.rect={top:i,left:0,width:t.canvasBitmapSize.width,height:r-i},e.onRender({pageMap:(a=e.currentPageMap,{pageAttrs:a.pageAttrs,sections:{main:yt(a.sections.main),footnotes:yt(a.sections.footnotes),header:yt(a.sections.header),footer:yt(a.sections.footer)}}),pageAttrs:t,selection:e.currentSelection,hasEquations:e.equations.hasEquations(),pageFragment:e.currentPageFragment,layoutRenderingStats:e.layoutRenderingStats.toJSON()}),e.currentPageFragment=null,e.currentPageMap=null,e.currentSelection=[],e.clearedRect=null,e.strikethroughLines=[]}else e.currentPartialMap&&e.currentPageFragment&&(e.onRender({partialPageMap:(s=e.currentPartialMap,{pageAttrs:s.pageAttrs,rect:s.rect,sections:{main:yt(s.sections.main)}}),pageAttrs:e.currentPartialMap.pageAttrs,selection:e.currentSelection,hasEquations:e.equations.hasEquations(),pageFragment:e.currentPageFragment,layoutRenderingStats:e.layoutRenderingStats.toJSON()}),e.currentPageFragment=null,e.currentPartialMap=null,e.clearedRect=null,e.strikethroughLines=[]);e.layoutRenderingStats.reset(),e.equations.reset()}var s,a;e.equations.onAfterRestore(e.saveCount,r)},moveTo(t,e,[n,o]){!function(t,e,n){t.footnote.footnoteLineDetected||!1!==N(t)&&(t.footnote.lastPosition={left:e,top:n})}(e,n,o),e.path.push({moveTo:mt(t,[n,o])})},lineTo(t,e,[n,o]){!function(t,e,n,o){var r;if(t.footnote.footnoteLineDetected)return;const i=N(t);if(!1===i)return;const s=t.footnote.lastPosition;if(s){const a=e-s.left;if((i||n>0&&Math.abs(s.top-n)<rt&&192===a&&(null===(r=null==t?void 0:t.savableState)||void 0===r?void 0:r.strokeStyle)&&R.includes(t.savableState.strokeStyle))&&(t.footnote={footnoteLineDetected:!0,footnoteLinePosition:s},t.savableState.renderContainer)){const r=E(e,n,o.getTransform());t.savableState.renderContainer.fragments.push({type:"footnote_line",y:r.top})}}t.footnote.footnoteLineDetected||(t.footnote.lastPosition={left:e,top:n})}(e,n,o,t),e.path.push({lineTo:mt(t,[n,o])})},beginPath(t,e){e.path=[]},clip(t,e,n){var o,r;if(e.layoutRenderingStats.recordRendering("clip",e.getRenderingPhase(),e.getLayoutNodeType()),e.equations.onClip(),n[0])e.logError("proxy.clip:unexpectedArguments","clip with parameters is not supported");else if(1!==e.path.length)e.logError("proxy.clip:unsupportedPath","clip with multiple paths is not supported",{pathSize:e.path.length});else if("rect"in e.path[0]){if(e.savableState.clips=[...e.savableState.clips,e.path[0].rect],e.savableState.renderContainer){const t={type:"clip",rect:e.path[0].rect,fragments:[]};e.savableState.renderContainer.fragments.push(t),e.savableState.renderContainer=t}if(e.currentPageMap){const t=(null!==(o=e.currentPageMap.sections.header.fragments.length)&&void 0!==o?o:0)>0,n=(null!==(r=e.currentPageMap.sections.footer.fragments.length)&&void 0!==r?r:0)>0;if(!t||!n)switch(Q(e)){case 1:t||(e.currentPageMap.sections.header.rect=vt(e));break;case 2:n||(e.currentPageMap.sections.footer.rect=vt(e))}}}else e.logError("proxy.clip:unsupportedPath","clip only supports rect paths");e.savableState.clipsId=++e.lastClipsId},rect(t,e,n){e.path.push({rect:ht(t,n)})},stroke(t,e,n){e.layoutRenderingStats.recordRendering("stroke",e.getRenderingPhase(),e.getLayoutNodeType()),H(e,n)},bezierCurveTo(t,e,[n,o,r,i,s,a]){e.path.push({bezierCurveTo:mt(t,[s,a])})},fill(t,e){if(e.layoutRenderingStats.recordRendering("fill",e.getRenderingPhase(),e.getLayoutNodeType()),"string"==typeof(n=t.fillStyle)&&X.includes(n)&&e.savableState.renderContainer){const t=function(t){if(9!==t.length)return;let e=1/0,n=1/0,o=-1/0,r=-1/0;for(let i=0;i<t.length;i++){let s;if(s=0===i?G(t[0]):i%2==1?B(t[i]):$(t[i]),!s)return;e=Math.min(s.left,e),n=Math.min(s.top,n),r=Math.max(s.left,r),o=Math.max(s.top,o)}return{left:e,top:n,width:r-e,height:o-n}}(e.path);if(t){const n={type:"code_block",rect:t};e.savableState.renderContainer.fragments.push(n)}}var n}},overrideSet:{strokeStyle(t,e,n){let o;return"string"==typeof n?("rgba(221,0,0,1)"!==n&&"rgba(66,133,244,1)"!==n||(o="rgba(0,0,0,0)"),e.savableState.strokeStyle=null!=o?o:n):e.savableState.strokeStyle=void 0,o},fillStyle:(t,e,n)=>"rgba(252,232,230,1)"===n||"rgba(232,240,254,1)"===n?"rgba(0,0,0,0)":void 0,font(t,e,n){e.savableState.font=n}}};function ht(t,[e,n,o,r]){const i=t.getTransform();return{...E(e,n,i),...C(o,r,i)}}function mt(t,[e,n]){return E(e,n,t.getTransform())}function yt(t){const{wordCount:e,...n}=t;return n}function vt(t){return t.savableState.clips.reduce(((t,e)=>t?function(t,e){const n=Math.max(t.left,e.left),o=Math.max(t.top,e.top),r=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height);return{left:n,top:o,width:n>r?0:r-n,height:o>i?0:i-o}}(t,e):e),null)}function bt(t,e,[n,o,r,i]){const s=ht(e,[n,o,r,i]);t.clearedRect=s,t.currentSelection=t.currentSelection.filter((t=>!f(t,s)))}function xt(t,e,n){let o;function r(r,i){const s=(void 0===o&&(o=null!==(a=e())&&void 0!==a?a:null,o||n.logError("createMeasuringFallbackMetricsMap","Can't create self-measuring canvas")),o);var a;if(!s)return;n.log("createMeasuringFallbackMetricsMap","No metrics for text"),s.font=r,s.measureText(i);const l=t.getMetrics(r,i);return l||n.logError("createMeasuringFallbackMetricsMap","Self-measuring failed for text"),l}return{get size(){return t.size},getMetrics(e,n){var o;return null!==(o=t.getMetrics(e,n))&&void 0!==o?o:r(e,n)},getFontMetrics(e){const n=t.getFontMetrics(e);return{fontStyle:e,get size(){return n.size},getMetrics(t){var o;return null!==(o=n.getMetrics(t))&&void 0!==o?o:r(e,t)}}},toJSON:()=>t.toJSON()}}class St{constructor(t,e){this._transport=t,this._api=e,this._disposed=!1,this._sub=this._transport.inbound.subscribe((async t=>{try{const e=this._api[t.data.method];if("function"!=typeof e)throw{message:`invalid method name ${String(t.data.method)}`};{const n={clientId:t.clientId},o=await e.call(this._api,n,...t.data.args);this._transport.outbound({clientId:t.clientId,data:{id:t.data.id,res:o}})}}catch(e){this._transport.outbound({clientId:t.clientId,data:{id:t.data.id,err:e}})}}))}dispose(){this._disposed||(this._disposed=!0,this._sub.unsubscribe())}}class wt extends Error{constructor(t){super(`Assertion failed: ${t?"string"==typeof t?t:t():"(unnamed)"}`)}}function Tt(t,e){if(!t)throw new wt(e)}function Et(t,e){if(null==t)throw new wt((()=>e?`Expected ${e} to be non-null`:"Expected non-null"));return t}function Ct(t,e,n){if(!(e in t))return!1;const o=t[e];return"function"==typeof o&&o.length===n}function Mt(t){return!("object"!=typeof t||!t)&&("number"==typeof t.start&&"number"==typeof t.end)}function kt(t){return Array.isArray(t)&&t.length>0&&void 0!==t[0]&&t.every(Mt)}function Rt(t,e){return{get:()=>e.reduce(((t,e)=>null==t?void 0:t[e]),t.get()),parent(){if(0!==e.length)return Rt(t,e.slice(0,-1))},getPath:()=>[t,e]}}function Nt(t){return{get(e){let n=e;for(const e of t){if(null==n)return;n=n[e]}return null!=n?n:void 0},getPath:()=>t}}function At(t,e){if(!function(t){if("object"!=typeof t||!t)return!1;if(![{name:"clear",length:0},{name:"get",length:1},{name:"size",length:0},{name:"map",length:1}].every((({name:e,length:n})=>Ct(t,e,n))))return!1;try{return Pt(t),!0}catch(t){return!1}}(t))return!1;for(const n of Object.values(t))if(Array.isArray(n)&&0!=n.length&&n.every((t=>void 0===t||e(t))))return!0;return!1}function Pt(t){const e=t,n=Object.keys(t).filter((t=>Array.isArray(e[t])));if(2!==n.length)throw new Error(`find more ${n.length} array keys`);const o=e[n[0]],r=e[n[1]];if(!1!==_t(o,r)){if(!1!==_t(r,o))return;return{indexKey:n[0],dataKey:n[1]}}if(!1!==_t(r,o))return{indexKey:n[1],dataKey:n[0]};throw new Error("we can not find the relationship between two arrays")}function _t(t,e){if(0!==t.length||0!==e.length){if(t.length>0&&e.length>0&&t.every((t=>"number"==typeof t&&void 0!==e[t]))){return function(t,e=3){const n=[];let o=0;for(const r of t){for(;o<r;){if(n.push(o),n.length===e)return n;o++}o=r+1}for(;n.length<e;)n.push(o++);return n}(t).every((t=>void 0===e[t]))}return!1}}function Ot(t){let e;function n(e){return t(Bt.extractingIndexLookupMapKeys),function(t){const e=Pt(t);if(e)return{indexes:Nt([e.indexKey]),data:Nt([e.dataKey])}}(e)}return{getIndexes:t=>(void 0===e&&(e=n(t)),e&&e.indexes.get(t)||[]),getData:t=>(void 0===e&&(e=n(t)),e&&e.data.get(t)||[])}}function*It(t,e){const n=e.getIndexes(t),o=e.getData(t);for(const t of n){const e=o[t];void 0!==e&&(yield[t,e])}}function Dt(t,e,n,o){if(!o)return re(t,e,2).results;const r=Object.entries(t).filter((([t,e])=>function(t,e){if(!e||"object"!=typeof e)return!1;return[{name:"splice",length:3},{name:"shift",length:3},{name:"mark",length:4},{name:"constructor",length:1}].every((({name:t,length:n})=>Ct(e,t,n)))}(0,e))).map((([t,e])=>({value:e,path:[t]}))),i=[];for(const{value:t,path:o}of r){const r=re(t,e,1).results;if(1===r.length)i.push({value:r[0].value,path:o.concat(r[0].path)});else if(r.length>1){const e=Jt(t);n($t.wrongLookupMapContainer,{signature:e,name:"lookupMapContainer",paths:r.map((t=>t.path.join(".")))})}}return i}function Lt(t,e,n,o){return Dt(t,(function(t,n){return function(t,e){let n=!1;return At(t,(t=>{if(!Array.isArray(t))return!1;for(const o of t){if(!jt(o))return!1;o===e&&(n=!0)}return!0}))&&n}(n,e)}),n,o.extractSuggestionByContainer)}function jt(t){return"string"==typeof t&&t.startsWith("suggest.")}function Ft(t){return Array.isArray(t)&&t.every(jt)}function Gt(t,e){return At(e,Ft)}const Bt={extractingAnnotationSets:"start to extract extractedAnnotationSets",openEndRangesMapPathExtracted:"openEndRangesMapPath extracted",extractingIndexLookupMapPaths:"extracting IndexLookupMapPaths",extractingDeletionIndexLookupMapPath:"extracting DeletionSuggestionIndexLookupMapPath",extractingIndexLookupMapKeys:"extracting suggestion index lookup map keys",extractContainerByAdditionLookupMap:"extract addition lookup map path by addition lookup map path",pickDeletionIndexLookupMapFromTwoMaps:"pick deletion lookup map from two lookup maps"},$t={canNotGetGDocsDocument:"can not get extracted gdocs document object",suggestionMustHaveSameStart:"suggestion range must have same start",suggestionCountNotMatch:"two SuggestionMaps must contains same amount of suggestions",canNotFindAnnotationSetContainer:"can not find annotation sets container",canNotGetSuggestionRangeFromLookupMap:"can not get suggestion range from lookup map",canNotExtractSuggestionRange:"can not extract suggestion range from suggestion",canNotGetFirstSuggestionId:"can not get first suggestion id, annotationMapAll is wrong",annotationSetsAreNotSameType:"suggestion sets do not have same type",canNotGetAdditionLookupMapContainer:"additionLookupMapContainer getter is wrong",canNotGetSuggestionMapAdd:"can not find annotationMapAdd by the same path for annotationMapAll",wrongLookupMapDetails:"get wrong suggestion lookup maps",wrongLookupMapContainer:"get wrong suggestion lookup map container"},zt=t=>`find ${t} suggestions set(s)`,qt=t=>`find ${t} suggestion Map(s) in suggestion set`,Kt=t=>`find ${t} deletion suggestion lookup map container(s)`,Wt=t=>`find ${t} suggestion lookup map(s)`,Ut=t=>`find ${t} deletion suggestion lookup map(s)`;const Vt=(t,e,n)=>{let o;for(const[r,i]of It(t,e))if(void 0===o)i.includes(n)&&(o=r);else if(0==i.length)return{start:o,end:r}};function Ht(t){const e=new Set;return t.map((t=>{for(const n of t)e.add(n)})),e.size}function Jt(t){let e=Object.getPrototypeOf(t);const n=[];for(;e&&e.constructor!==Object;)if(e&&e.constructor!==Object){const t=Object.getOwnPropertyNames(e).filter((t=>t.length>3&&"constructor"!==t&&"function"==typeof e[t])).map((t=>`${t}(${e[t].length})`));n.push(t),e=Object.getPrototypeOf(e)}return n}function Yt(t,e){if("object"==typeof e&&e&&Ct(e,"constructor",5))for(const[t,n]of Object.entries(e))if(Xt(t,n))return!0;return!1}function Xt(t,e){return"object"==typeof e&&!!e&&"constructor"in e&&"clear"in e&&"contains"in e&&"add"in e&&"function"==typeof e.add&&4===e.add.length}function Qt(t,e,n,o,r){o(Bt.pickDeletionIndexLookupMapFromTwoMaps);const i=function(t){const e=Ht(t[0]),n=Ht(t[1]);if(e!==n)return e<n?0:1;return}(e);return void 0!==i?i:function([t,e],n,o,r){const i=Object.keys(o).find(jt),s=Vt(t,n,i),a=Vt(e,n,i);if(!s||!a){const e=Jt(t);throw r($t.wrongLookupMapDetails,{signature:e,name:"suggestionLookupMap"}),new Error($t.canNotGetSuggestionRangeFromLookupMap)}const l=o[i],c=l.contains(s.start,s.end),u=l.contains(a.start,a.end);if(!c||!u)return c?1:0;return s.start>a.start?0:1}(e,t,n,r)}function Zt(t,e,n,o,r,i,s,a){const l=r.getAnnotationMap(e);if(!l)return;const c=r.getAnnotationMap(n);if(!c)throw new Error($t.canNotGetSuggestionMapAdd);const u=function(t,e){const n=Object.keys(t).filter(jt),o=Object.keys(e).filter(jt);if(n.length!==o.length){for(const t of n)if(!e[t])return t;if(n.length<o.length)throw new Error($t.canNotGetFirstSuggestionId)}}(l,c);return u?function(t,e,n,o,r){n(Bt.extractingDeletionIndexLookupMapPath);const i=Lt(t,e,o,r);if(1==i.length)return te(i[0].path);throw new Error(Ut(i.length))}(t,u,i,s,a):function(t,e,n,o,r,i){o(Bt.extractingIndexLookupMapPaths);const s=function(t,e,n){return Dt(t,Gt,e,n)}(t,r,i.extractSuggestionByContainer);if(1==s.length){const[t,...e]=s[0].path;return function(t,e,n){let o;return{getDeletionLookupMap(r){if(void 0===o){const i=t.get(r);if(!i)throw new Error($t.canNotGetAdditionLookupMapContainer);const s=function(t,e,n){n(Bt.extractContainerByAdditionLookupMap);const o=[];for(const[n,s]of Object.entries(e))(r=s)!==(i=t)&&"object"==typeof r&&r&&r.constructor===i.constructor&&o.push(n);var r,i;if(1===o.length)return Nt([o[0]]);if(o.length>1)throw new Error(Kt(o.length))}(i,r,n);if(!s)return;o=Nt([...s.getPath(),...e.getPath()])}return o.get(r)}}}(Nt([t]),Nt(e),o)}if(2==s.length){const t=Qt(n,[s[0].value,s[1].value],e,o,function(t,e){return(n,o)=>{const r=e(o);t(n,r?{...r,...o}:o)}}(r,(()=>({paths:s.map((t=>t.path.join(".")))}))));return te(s[t].path)}const a=Jt(t);throw r($t.wrongLookupMapDetails,{signature:a,name:"gdocsDocument",paths:s.map((t=>t.path.join(".")))}),new Error(Wt(s.length))}(t,c,o,i,s,a)}function te(t){const e=Nt(t);return{getDeletionLookupMap:t=>e.get(t)}}function ee(t){const e=Object.entries(t).map((([t,e])=>{if("object"!=typeof e||!e)return null;const n=Object.keys(e).filter(jt);if(0===n.length)return null;return{openEndRangesMapPath:t,annotationMap:e,suggestionIds:n,range:function(t){const e=re(t,((t,e)=>kt(e)),0);if(1!==e.results.length)throw new Error($t.canNotExtractSuggestionRange);return e.results[0].value[0]}(e[n[0]])}})).filter(Boolean);if(0===e.length)return;if(2!=e.length)throw new Error(qt(e.length));const[n,o]=e;if(n.suggestionIds.length!==o.suggestionIds.length||n.suggestionIds.some((t=>!o.annotationMap[t])))throw new Error($t.suggestionCountNotMatch);if(n.range.start!==o.range.start)throw new Error($t.suggestionMustHaveSameStart);return n.range.end>o.range.end?Nt([n.openEndRangesMapPath]):Nt([o.openEndRangesMapPath])}function ne(t,e,n,o,r){try{const i=function(t,e){e(Bt.extractingAnnotationSets);const n=re(t,Yt,1);if(1!==n.results.length)throw new Error($t.canNotFindAnnotationSetContainer);const o=re(n.results[0].value,Xt,1);if(2!==o.results.length)throw new Error(zt(o.results.length));const r=o.results[0].value,i=o.results[1].value;if(i.constructor!==r.constructor)throw new Error($t.annotationSetsAreNotSameType);return{annotationSetAll:r,annotationSetAdd:i}}(t,o),s=Ot(o),a=function(t){let e;return{getAnnotationMap:n=>(void 0===e&&(e=ee(n),e&&t(Bt.openEndRangesMapPathExtracted)),null==e?void 0:e.get(n))}}(o);let l,c;return{getDeleteSuggestionRanges(){try{return void 0===c&&(void 0===l&&(l=Zt(e,i.annotationSetAll,i.annotationSetAdd,s,a,o,n,r)),l&&(c=l.getDeletionLookupMap(e))),c?((t,e)=>{const n=[];let o=-1;for(const[r,i]of It(t,e))-1===o?i.length>0&&(o=r):0==i.length&&(n.push({start:o,end:r}),o=-1);return n})(c,s):[]}catch(t){return c=null,n(t.message),[]}}}}catch(t){return n(t.message),{getDeleteSuggestionRanges:()=>[]}}}function oe(t,e,n){const o=t.get();if(!o)return[void 0,void 0,void 0];const r=re(o,e,n);if(!r.results.length)return[void 0,void 0,void 0];const i=r.results.map((e=>Rt(t,e.path)));return[i[0],r.results[0].value,i]}function re(t,e,n,o=Object.getOwnPropertyNames(t),r=0,i){var s;const a=new Set,l=[];let c=0;const u=performance.now();let f,g;const p=(t,e,n,o)=>{if(null==t)return;if(a.has(t))return;if(a.add(t),i&&!i(t,e))return;const r={next:void 0,value:t,key:e,parent:n,depth:o};g?g.next=r:f=r,g=r},d=()=>{const t=f;return t&&(f=t.next,f||(g=void 0)),t},h=t=>{const e=[];let n=t;for(;n;)e.push(n.key),n=n.parent;return e.reverse()};for(const e of o)"prototype"!==e&&p(t[e],e,void 0,0);for(;f;){const t=d();if(!t)break;c++;const{key:o,value:i,depth:a}=t;if(!(i instanceof Window)&&!(i instanceof Node)){try{const t=null===(s=null==i?void 0:i.constructor)||void 0===s?void 0:s.name;if("Window"===t||"HTMLDocument"===t)continue}catch(t){}if(!(a>n)){try{if(e(o,i)){const e=h(t);l.push({path:e,value:i,depth:a,iterations:c,performance:performance.now()-u});continue}}catch(t){}if(null!=i)if(Array.isArray(i))for(let e=0;e<i.length&&e<r;e++)try{p(i[e],`${e}`,t,a+1)}catch(t){}else if("function"==typeof i);else if(i instanceof Object)if(i instanceof Node);else for(const e of Object.getOwnPropertyNames(i))if("prototype"!==e)try{p(i[e],e,t,a+1)}catch(t){}}}}return{results:l,iterations:c,performance:performance.now()-u}}function ie(t){let e,n=0;const o=()=>{n++,e=t()};return{get calcCount(){return n},refresh:o,get:()=>(0===n&&o(),e)}}function se(t){const e=Et(Object.getOwnPropertyNames(t).find((t=>-1!==t.toString().indexOf("_kixApp")))),n=Et(t[e],"kixApp"),o=function(t,e){const n=new Set;return t.filter((t=>{const o=e(t);return!n.has(o)&&(n.add(o),!0)}))}(re(n,((t,e)=>"string"==typeof e&&""===e.charAt(0)),5).results,(t=>t.value)).filter((t=>isNaN(parseInt(t.path[t.path.length-1],10))));for(const t of o){const o=t.path.slice(0,t.path.length-1).reduce(((t,e)=>t[e]),n);if(1===re(o,ae,2).results.length)return[e].concat(t.path);if(1===re(o,le,2).results.length)return[e].concat(t.path)}return null}function ae(t,e){return Array.isArray(e)&&h.some((t=>e.length===t.length&&e.every(((e,n)=>e.charCodeAt(0)===t[n]))))}function le(t,e){return e instanceof RegExp&&v.includes(e.toString())}function ce(t){try{const e=t.get();if(!e)return null;const n=re(e,((t,e)=>function(t){return fe(t)&&Boolean(t.length>0&&void 0!==t[0])}(e)),3,void 0,void 0,((t,e)=>!(t&&"object"==typeof t&&(e.length>4&&/^[0-9a-f]+$/.test(e)||"docs-text-overlay-selection"in t||"docs-text-overlay-bookmark"in t||"cell-grid"in t))));return n.results.length>0?Rt(t,n.results[0].path):null}catch(t){return null}}function ue(t){return Boolean(t&&"object"==typeof t&&"start"in t&&"number"==typeof t.start&&"end"in t&&"number"==typeof t.end)}function fe(t){return Boolean(t&&Array.isArray(t)&&t.every(ue))}function ge(t,e,n){return t.push(Array.isArray(e)||isNaN(e)?n:e),t}class pe{constructor(t,e,n,o){this._win=t,this._logError=e,this._logInfo=n,this._options=o,this._result=null,this._resizer=void 0,this._kixApp=function(t){const e=Et(Object.getOwnPropertyNames(t).find((t=>-1!==t.toString().indexOf("_kixApp"))));return Rt((n=t,{get:()=>n}),[e]);var n}(this._win),this._images=ie((()=>function(t){const e="inline";try{const[n]=oe(t,((t,n)=>(t===e||"positioned"===t)&&"object"==typeof n),5);Tt(!!n);const o=n.parent();Tt(!!o);const[r,i]=oe(n,((t,e)=>At(e,(t=>Array.isArray(t)))),5);Tt(!!r&&!!i);const s=Et(Object.keys(i)[0]),[a,l]=Et(r.getPath());return{inline:Rt(o,[e,...l,s])}}catch(t){return{inline:null,error:t}}}(this._kixApp))),this._textSelection=ie((()=>ce(this._kixApp)))}_attemptTextExtraction(){try{const t=se(this._win),e=function(t){const e=Et(Object.getOwnPropertyNames(t).find((t=>-1!==t.toString().indexOf("_kixApp")))),n=re(Et(t[e],"kixApp"),((t,e)=>"horizontal_rule"===t&&"object"==typeof e&&null!==e&&2===Object.keys(e).length),6);return 0===n.results.length?null:[e].concat(Et(n.results[0]).path,Object.keys(n.results[0].value)[0])}(this._win);let n=!1;this._images.refresh();const o=t?[...t]:[],r=o.pop(),i=o.reduce(((t,e)=>t[e]),this._win),s=null==e?void 0:e.pop(),a=e?null==e?void 0:e.reduce(((t,e)=>t[e]),this._win):{};if(o.length>0){const t=this.getKixApp(),e=ne(t,o.slice(0,-1).reduce(((t,e)=>t[e]),this._win),((t,e)=>this._logError("ExtractSuggestionInternals",t,e)),(t=>this._logInfo("ExtractSuggestionInternals",t)),{extractSuggestionByContainer:this._options.extractSuggestionByContainer}),l=t=>{const e=null==t?void 0:t.get();return Array.isArray(e)?e.reduce(ge,[]):[]};return{getText:()=>{const t=i[r];if("string"!=typeof t)throw this._logError("ExtractFullText","unexpected text value type"),new Error("unexpected text value type");const o=a[s],c=Array.isArray(o)?o.reduce(ge,[]).sort(((t,e)=>t-e)):[];let u=l(this._images.get().inline);return n||(u.length>0?n=!0:this._images.calcCount<10&&"string"==typeof t&&t.indexOf("*")>=0&&(this._images.refresh(),u=l(this._images.get().inline),n=u.length>0)),{fullText:t,deleteSuggestionRanges:null==e?void 0:e.getDeleteSuggestionRanges(),nonTextEntities:{horizontal_rule:{startsAt:c,textRepresentation:"-"},inline_image:{startsAt:u,textRepresentation:"*"}}}}}}return{error:"notFound"}}catch(t){return{error:"exception",message:t.message}}}_attemptResizerExtraction(){const t=function(t){try{return[Et(Object.getOwnPropertyNames(t).find((t=>-1!==t.toString().indexOf("_kixApp"))))].concat("resize")}catch(t){return null}}(this._win);try{return t?t.reduce(((t,e)=>t[e]),this._win):null}catch(t){return null}}_tryGetTextSelectionRanges(t){const e=()=>{const t=this._textSelection.get();if(t){const e=t.get();if(fe(e))return e}return null},n=e();return n||(t&&this._textSelection.calcCount<10&&this._textSelection.refresh(),e())}_getText(t){try{if(this._result||(this._result=this._attemptTextExtraction()),"getText"in this._result){return{...this._result.getText(),textSelectionRanges:this._tryGetTextSelectionRanges(t.expectTextSelection)}}return null}catch(t){return null}}getKixApp(){return this._kixApp.get()}getText(t){return this._getText(t)}triggerRender(){try{return void 0===this._resizer&&(this._resizer=this._attemptResizerExtraction()),this._resizer?(this._resizer(),!0):!1}catch(t){return!1}}}function de(t,e){const n=function(t,e){const n=re(t,((t,e)=>function(t){if("object"==typeof t&&null!==t&&"function"==typeof t.getSelection&&"function"==typeof t.constructor&&3===t.constructor.length){const e=t.getSelection();return null!=e&&"object"==typeof e&&"function"==typeof e.constructor&&6===e.constructor.length}return!1}(e)),1);if(1!==n.results.length)return e("extractSelectionController",he(n.results,"selection controller")),null;const o=n.results[0].value,r=o.getSelection();if(!r)return null;const i=re(o,me,0,Object.getOwnPropertyNames(Object.getPrototypeOf(o)));if(1!==i.results.length)return e("extractSetSelectionResult",he(i.results,"setSelection"),i.results),null;const s=i.results[0].value;return{selectionController:o,selectionControllerAccessors:{setSelection(t,e,n){s.call(t,e,n)}},currentSelection:r}}(t,e),o={GDocsTextRange:null,GDocsCursor:null,GDocsSelectionCursor:null,GDocsSelection:null,selectionController:null,selectionControllerAccessors:null};if(!n)return o;const{selectionController:r,selectionControllerAccessors:i,currentSelection:s}=n;o.selectionController=r;const{GDocsSelection:a,GDocsCursor:l,GDocsTextRange:c,selectionAccessors:u,currentCursor:f}=function(t){const e=t.constructor,n=function(t){const e=re(t,((t,e)=>function(t){if("object"!=typeof t||!t)return!1;const e=t.constructor;return 3===(null==e?void 0:e.length)&&"function"==typeof t.shift&&1===t.shift.length}(e)),0);if(1!==e.results.length)return null;const n=e.results[0].value,o=n.constructor,r=e.results[0].path[0];return{GDocsCursor:o,currentCursor:n,cursorPropName:r}}(t);if(!n)return{GDocsSelection:e,GDocsCursor:null,GDocsTextRange:null,currentCursor:null,selectionAccessors:null,wrapSelection:null};const{GDocsCursor:o,currentCursor:r,cursorPropName:i}=n,s=re(t,((t,e)=>kt(e)),0),a=re(t,l,0,Object.getOwnPropertyNames(Object.getPrototypeOf(t)));function l(e,n){return"function"==typeof n&&1===n.length&&!1===n.call(t,{})&&!0===n.call(t,t)}if(1===s.results.length&&1===a.results.length){const t=s.results[0].path[0],n=a.results[0].value,l={getCursor:t=>t[i],getRanges:e=>e[t],equals:(t,e)=>n.call(t,e)};return{GDocsSelection:e,GDocsCursor:o,GDocsTextRange:s.results[0].value[0].constructor,currentCursor:r,selectionAccessors:l}}return{GDocsSelection:e,GDocsCursor:o,GDocsTextRange:null,currentCursor:r,selectionAccessors:null}}(s);if(o.GDocsSelection=a,o.GDocsCursor=l,o.GDocsTextRange=c,o.selectionControllerAccessors=i,o.selectionAccessors=u,!f)return o;const g=function(t,e){const n=re(t,((t,n)=>n!==e&&function(t){return!("object"!=typeof t||!t)&&3===t.constructor.length}(n)),0);if(2!==n.results.length)return null;const o=n.results[0].value;return o.constructor}(s,f);return o.GDocsSelectionCursor=g,o}const he=(t,e)=>`Failed to extract ${e}, found ${t.length<5?t.length:">5"} candidates`;function me(t,e){return"function"==typeof e&&2===e.length}var ye;!function(t){t.PagedMode="kix-document",t.PagelessMode="docstext-simple"}(ye||(ye={}));const ve=(t,e)=>{const{results:n}=re(t,((t,e)=>(t=>{const e=[ye.PagedMode,ye.PagelessMode];return"object"==typeof t&&null!==t&&"function"==typeof t.isRoot&&t.isRoot()&&"function"==typeof t.getType&&e.includes(t.getType())})(e)),5);if(1!==n.length)return e("extractGDocsInternalsLayoutTree",`Failed to extract GDocsInternalsLayoutTree, found ${n.length} instances.`),{status:"fail",failReason:0===n.length?"noInstances":"multipleInstances"};return{status:"success",rootNodeType:n[0].value.getType()}};function be(t,e,n,o){const r=t[e];if("function"!=typeof r)throw new Error(`Cannot patch non-function ${String(e)}`);const i=new Proxy(r,{apply(t,e,i){let s;const a=()=>{if(!s)try{s={originalResult:r.apply(e,i)}}catch(t){s={originalError:t}}if("originalError"in s)throw s.originalError;return s.originalResult};try{n(i,a,e)}catch(t){if(!(s&&"originalError"in s&&t===s.originalError))try{o(t,i)}catch(t){}}return a()}});t[e]=i;let s=!0;return{dispose:function(){if(s){if(t[e]!==i)throw new Error("Cannot un-patch the object");t[e]=r,s=!1}}}}function xe(t,e){if("object"!=typeof t||null===t)return;const n=t[e];return"function"==typeof n?n:void 0}function Se(t){if(null===t||"object"!=typeof t)return!1;const e=t;if("function"!=typeof e.register||e.register.length<3)return!1;return Object.values(e).some(we)}function we(t){if(null===t||"object"!=typeof t)return!1;const e=t[w];return"object"==typeof e&&null!==e}function Te(t){var e;return(e=Se,re(t,((t,n)=>e(n)),5).results).map((t=>t.value))}function Ee(t,e,n,o){const r=Te(t);if(0===r.length)throw new Error("No layout renderer registries found");const i=function(t){const e=Object.entries(t).filter((([t,e])=>we(e)));if(1!==e.length)throw new Error(`Cannot find the registry record: ${e.length} matched`);const n=e[0][0];return{getRegistryRecord:t=>t[n]}}(r[0]),s=r[0].constructor,a=r.filter((t=>t.constructor===s));for(const t of a)c(t);const l=be(Object.getPrototypeOf(r[0]),"register",(([t,o,r],i)=>{try{i()}catch(e){return void n(e,t,o)}e(t,o,r)}),((t,[e,n])=>o(t,e,n)));return{dispose(){l.dispose()}};function c(t){const n=i.getRegistryRecord(t);for(const[t,o]of Object.entries(n))if("string"==typeof t)for(const[n,r]of Object.entries(o))"string"==typeof n&&e(t,n,r)}}function Ce(t,e,n=(()=>!0)){const o=new Map,r=new Map,i=new Set;let s=!1,a=null;const l=Ee(t,(function(t,i,a){if(n(t,i)&&!o.has(a.constructor)){const e=Object.getPrototypeOf(a);o.set(a.constructor,{rendererProto:e,phase:t,nodeType:i}),s&&f(e,t,i)}const l=r.get(a);l?(l.phase!==t&&e("Renderer registered for multiple phases",{phases:[l.phase,t],nodeType:i}),l.phases.add(t)):r.set(a,{phases:new Set([t]),phase:t})}),((t,n,o)=>{e("Error in original #register method",{error:t,phase:n,nodeType:o})}),((t,n,o)=>{e("Error in #register hook",{error:t,phase:n,nodeType:o})}));let c;try{c=function(t){if(0===t.length)throw new Error("Cannot find the #paint method name: no samples.");let e=null;for(const n of Object.keys(t[0]))if("constructor"!==n&&t.every((t=>xe(t,n)))&&t.some((t=>{var e;return 3===(null===(e=xe(t,n))||void 0===e?void 0:e.length)}))){if(e)throw new Error("Cannot find the #paint method name: multiple candidates.");e=n}if(!e)throw new Error("Cannot find the #paint method name: no candidates.");return e}([...o.values()].map((t=>t.rendererProto)));for(const[t,e]of o)f(e.rendererProto,e.phase,e.nodeType);return s=!0,{isRendering:()=>null!==a,getNodeType:()=>a?a.nodeType:null,getNode:()=>a?a.node:null,getRenderingPhase:()=>a?a.phase:null,dispose:u}}catch(t){throw u(),t}function u(){s=!1,l.dispose();for(const t of i)t.dispose()}function f(t,n,o){try{i.add(be(t,c,g,((t,[r,i])=>{let s;try{s=i&&"function"==typeof i.getType&&0===i.getType.length?i.getType():"[type-mismatch]"}catch(t){s="[error]"}e("Error in #paint hook",{error:t,phase:n,nodeType:o,paintNodeType:s})})))}catch(t){e("Failed to patch a renderer class",{error:t,phase:n,nodeType:o})}}function g([t,n],o,i){var s,l;const c=a;try{const t=r.get(i),u=n&&"function"==typeof n.getType?n.getType():null,f=null!==(l=null!==(s=null==t?void 0:t.phase)&&void 0!==s?s:null==c?void 0:c.phase)&&void 0!==l?l:null;a={parent:c,phase:f,nodeType:u,node:n};try{o()}catch(t){e("Error in original #paint method",{error:t,phase:f,nodeType:u})}}finally{a=c}}}function Me(t){return function(t){return t&&"wrappedJSObject"in t}(t)?t.wrappedJSObject:t}function ke(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:46,key:"Delete"}))}function Re(t,e){const n=void 0===e.html?void 0:function(t,e){try{return t()}catch(t){return e(t)}}((()=>new DataTransfer),(()=>{})),o=new InputEvent("beforeinput",{inputType:"insertReplacementText",data:e.plain,dataTransfer:n,cancelable:!0,bubbles:!0});o.dataTransfer&&(void 0!==e.plain&&Me(o.dataTransfer).setData("text/plain",e.plain),void 0!==e.html&&Me(o.dataTransfer).setData("text/html",e.html)),t.dispatchEvent(o)}function Ne(t,e){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight",shiftKey:!0})),e(),function(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft",shiftKey:!0}))}(t)}var Ae,Pe,_e,Oe,Ie,De;!function(t){t.equals=function(t,e){return S(t.left,e.left)&&S(t.top,e.top)},t.fromCartesian=function({x:t,y:e}){return{top:e,left:t}},t.toCartesian=function({top:t,left:e}){return{x:e,y:t}},t.zero={top:0,left:0},t.minus=function(t,e){return{top:t.top-e.top,left:t.left-e.left}},t.plus=function(t,e){return{top:t.top+e.top,left:t.left+e.left}},t.ceil=function(t){return{left:Math.ceil(t.left),top:Math.ceil(t.top)}},t.floor=function(t){return{left:Math.floor(t.left),top:Math.floor(t.top)}},t.create=function(t){return{top:t.top,left:t.left}},t.l1Distance=function(t,e){return Math.abs(t.top-e.top)+Math.abs(t.left-e.left)}}(Ae||(Ae={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.fromClientPoint=function(t,n,o){return e({top:t.top-n.top+o.top,left:t.left-n.left+o.left})},t.zero={top:0,left:0}}(Pe||(Pe={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.fromOffsetPoint=function(t,n,o){return e({top:t.top+n.top-o.top,left:t.left+n.left-o.left})},t.fromPage=function(t,n){return e({top:t.top-n.top,left:t.left-n.left})}}(_e||(_e={})),function(t){function e(t){return{top:t.top,left:t.left}}t.create=e,t.getHighlightsPosition=function(t,n,o,r={top:0,left:0}){return e({top:t.top+n.top+o.top+r.top,left:t.left+n.left+o.left+r.left})},t.fromClient=function(t,n){return e({top:t.top+n.top,left:t.left+n.left})},t.fromOffset=function(t,e,n){return{top:t.top+e.top-n.top,left:t.left+e.left-n.left}}}(Oe||(Oe={})),function(t){t.editorElementSelector="div.kix-appview-editor",t.textEventsTargetIframeSelector="iframe.docs-texteventtarget-iframe",t.textEventsTargetElementSelector='[contenteditable="true"]'}(Ie||(Ie={})),function(t){t.spellingBubbleSelector="div.kix-spell-bubble",t.sellingUnderlinePromoBubbleSelector="div.jfk-bubble.jfk-bubble-promo.docs-promo-bubble",t.pageLessModeTableMaskInner="kix-domviewscroller-inner",t.pageLessModeTableMaskOuter="kix-domviewscroller-outer"}(De||(De={}));const Le={success:!1,textChanged:!1,failReason:"noFullText"},je={success:!1,textChanged:!1,failReason:"fullTextMismatch"},Fe={success:!1,textChanged:!1,failReason:"noInternals"},Ge={success:!1,textChanged:!1,failReason:"noEventTarget"},Be={success:!1,textChanged:!1,failReason:"wrongRange"},$e={success:!1,textChanged:!0,failReason:"noFullTextAfter"},ze={success:!1,textChanged:!0,failReason:"resultTextMismatch"},qe={success:!0,textChanged:!0,failReason:null},Ke={...qe,withIgnoreRanges:!0};function We(t,e){Re(t,{plain:e})}class Ue{constructor(t,e,n,o,r){this._getInternals=t,this._getFullTextInfo=e,this._getKeyboardEventTarget=n,this._getDocumentViewElement=o,this._getEditorViewElement=r}_resetSelectionNoScroll(){var t,e;const n=this._getDocumentViewElement();if(!n)return!1;const o=this._getEditorViewElement();if(!o)return!1;const r=null===(t=n.getClientRects())||void 0===t?void 0:t.item(0);if(!r||r.width<=0||r.height<=0)return!1;const i=null===(e=o.getClientRects())||void 0===e?void 0:e.item(0);if(!i||i.width<=0||i.height<=0)return!1;const s=Math.max(r.left,i.left),a=Math.min(r.right,i.right),l=Math.max(r.top,i.top),c=Math.min(r.bottom,i.bottom);if(s>a||l>c)return!1;const u=Math.floor((s+a)/2),f=Math.floor(l+c)/2;return function(t,e=_e.create({left:0,top:0}),n=!1){const o={clientX:e.left,clientY:e.top,bubbles:!0,shiftKey:n};t.dispatchEvent(new MouseEvent("mousedown",o)),t.dispatchEvent(new MouseEvent("mouseup",o))}(n,_e.create({left:u,top:f})),!0}replaceText({start:t,end:e},n,o){const r=this._getFullTextInfo();if(null===r)return Le;const i=r.fullText;if(void 0!==o&&i!==o)return je;const s=this._getInternals();if(!s)return Fe;const a=this._getKeyboardEventTarget();if(!a)return Ge;if(t>e||t<0||e>i.length)return Be;const l=()=>{const t=s.selectionController.getSelection();a.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:39,key:"ArrowRight",code:"ArrowRight"}));const e=s.selectionController.getSelection();(t===e||s.selectionAccessors.equals(t,e))&&function(t){t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0,cancelable:!0,keyCode:37,key:"ArrowLeft",code:"ArrowLeft"}))}(a)},c=()=>{const t=s.selectionController.getSelection();return s.selectionAccessors.getRanges(t).length>0};c()&&(this._resetSelectionNoScroll()&&!c()||l());const u=function(t,e,n){const o=new t.GDocsCursor(n);if(n>e){const r=new t.GDocsCursor(e),i=new t.GDocsSelectionCursor(e,n-1,r),s=new t.GDocsSelectionCursor(e,n-1,o);return new t.GDocsSelection(o,s,i)}return new t.GDocsSelection(o,null,null)}(s,t,e);s.selectionControllerAccessors.setSelection(s.selectionController,u,!0),t===e?""!==n&&We(a,n):""===n?ke(a):We(a,n);const f=function({getFullTextInfo:t,fullTextBefore:e,newText:n,start:o,end:r}){const i=t(),s=e.slice(0,o)+n+e.slice(r);if((null==i?void 0:i.fullText)===s)return qe;const a=t();if(a){const t=a.fullText===e.slice(0,o)+n+e.slice(o),i=o+n.length,s=r+n.length;if(t&&function(t,e,n){const{deleteSuggestionRanges:o}=t;if(o)for(const{start:t,end:r}of o)if(t<=e&&n<=r)return!0;return!1}(a,i,s))return Ke}if(!i&&!a)return $e;return ze}({getFullTextInfo:this._getFullTextInfo,fullTextBefore:i,newText:n,start:t,end:e});return f!==Le&&c()&&l(),f}}function Ve(t){let e=!0;const n=new Set;return{onRender(o,r){e?n.add([o,r]):t(o,r)},pause(){e=!0},resume(){e=!1,(()=>{const e=[...n.values()];n.clear();for(const[n,o]of e)t(n,o)})()}}}function He(e,n,o=1){const r=new Set;let i=!1;return{onRender(s){if(s.pageFragment.partialRect)r.add(s),(async()=>{if(i)return;if(await t(0),i)return;if(!r.size)return;i=!0,n(),await t(o),i=!1;const s=[...r.values()];r.clear();for(const t of s)e.onRender(t,!0)})();else{let t=!1;if(i=!1,r.size){const e=s.pageFragment.pageAttrs.pageOffsetRect,n=[...r.values()];for(const o of n){f(o.pageFragment.pageAttrs.pageOffsetRect,e)&&(r.delete(o),t=!0)}}e.onRender(s,t)}},pause(){e.pause()},resume(){e.resume()}}}const Je=(e,n,r)=>(s,a,l)=>{const c=()=>document.querySelector(".kix-rotatingtilemanager:not(.docs-ui-unprintable *)");!async function(){var u;try{const f=await i(10,0,(()=>{return t=400,n=e.api.getInitOptions(),Promise.race([o(t),n]);var t,n})),g=null!==(u=c())&&void 0!==u?u:await async function(){let e=120;const n=250;for(;e;){await t(n);const o=c();if(o)return o;e--}return null}();if(!g)return void e.api.logError("injected.starting","Injected init failed: Cannot find rotating tile manager in 30 seconds");const p=()=>function(t){var e,n,o;try{return null!==(o=null===(n=null===(e=t.querySelector(Ie.textEventsTargetIframeSelector))||void 0===e?void 0:e.contentDocument)||void 0===n?void 0:n.querySelector(Ie.textEventsTargetElementSelector))&&void 0!==o?o:null}catch(t){return null}}(document),d=()=>{var t;return null!==(t=document.querySelector(".kix-appview-editor"))&&void 0!==t?t:null},h=function(t,e,n,o){const r=new pe(self,e,n,{extractSuggestionByContainer:o.extractSuggestionByContainer});let i=r.getKixApp(),s=null,a=null,l=0,c=0;function u(){l>=10||(l++,i=r.getKixApp(),s=i?de(i,e):null,a=s&&s.GDocsCursor&&s.GDocsSelection&&s.GDocsTextRange&&s.GDocsSelectionCursor&&s.selectionController&&s.selectionControllerAccessors&&s.selectionAccessors?s:null)}const f=function(){if(!i)return null;const t=e.bind(null,"monitorLayoutNodeRenderers");try{return Ce(i,t)}catch(e){return t("Failed to create layout node renderers monitor",e),null}}();return{fullTextExtractor:r,get gdocsApp(){return r.getKixApp()},get selection(){return s||u(),s},getSelectionFull(){if(s||u(),!a){if(!s)return null;t((()=>{u()}))}return a},getLayoutTreeAvailability:()=>c>=2?null:(c++,i=r.getKixApp(),i?ve(i,e):{status:"fail",failReason:"noInstances"}),getRenderingPhase:()=>f?f.getRenderingPhase():null,getLayoutNodeType:()=>f?f.getNodeType():null,getLayoutNode:()=>f?f.getNode():null,dispose(){f&&f.dispose()}}}((t=>{const e=p();e&&Ne(e,t)}),e.api.logError,e.api.log,{extractSuggestionByContainer:f.extractSuggestionByContainer}),m=new Ue((()=>h.getSelectionFull()),(()=>h.fullTextExtractor.getText({expectTextSelection:!1})),p,(()=>g),d),y=function(e,n,o){let r=!1,i=!1;let s=Ve(((t,s=!1)=>{const a={fullText:i||!r?null:o.getText({expectTextSelection:t.selection.length>0}),renderResult:t,forcedFullRender:s};e.pageRendered(a,n)}));return s.pause(),{onRender(t){s.onRender(t)},init:t=>{t.forceFullRender&&(s=He(s,(()=>o.triggerRender()))),a()}};async function a(){if(await t(0),r||i)return;null===o.getText({expectTextSelection:!1})?(i=!0,e.logError("FullTextExtractor","Cannot get full document text")):r=!0,s.resume()}}(e.api,n,h.fullTextExtractor),v=xt(a.metricsMap,(()=>document.createElement("canvas").getContext("2d")),e.api);s((t=>{if(function(t){return t.matches(".kix-canvas-tile-content")}(t)){const n=function(t){return{...t,matchingBroken:!1,currentSelection:[],currentPageFragment:null,currentPageMap:null,currentPartialMap:null,saveCount:0,savedState:[],savableState:{clips:[],clipsId:0,font:void 0,strokeStyle:void 0,renderContainer:null},path:[],lastClipsId:0,lastTextClipsId:0,lastTextWhitespaceWidth:0,clearedRect:null,footnote:{footnoteLineDetected:!1},compact:!1,strikethroughLines:[],equations:O(),layoutRenderingStats:t.collectLayoutRenderingStats?U():{recordRendering(){},reset(){},toJSON:()=>null}}}({log:e.api.log,logError:e.api.logError,logException:e.api.logException,collectLayoutRenderingStats:f.collectLayoutRenderingStats,useStrikethroughFiltering:f.useStrikethroughFiltering,useCodeBlockFiltering:f.useCodeBlockFiltering,metricsMap:v,getRenderingPhase:()=>h.getRenderingPhase(),getLayoutNodeType:()=>h.getLayoutNodeType(),getLayoutNode:()=>h.getLayoutNode(),getCurrentPageAttrs(){var e;const n=g.getBoundingClientRect(),{left:o,top:r,width:i,height:s}=t.getBoundingClientRect(),a={left:o-n.left,top:r-n.top,width:i,height:s};return{canvasBitmapSize:{width:t.width,height:t.height},pageOffsetRect:a,isCompactLayout:Boolean(null===(e=t.parentElement)||void 0===e?void 0:e.classList.contains("kix-page-canvas-compact-mode"))}},onRender(e){(function(t){return t.matches("canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)")})(t)&&y.onRender(e)}});return function(t){return D(t,dt,t)}(n)}})),r({replaceText:m.replaceText.bind(m),getLayoutTreeAvailability:()=>h.getLayoutTreeAvailability()});if(!await e.api.init())return void e.api.logError("injected.starting","Injected init failed: server init failed");y.init(f),await t(1e3),a.metricsMap.size||await e.api.logError("init.textMeasuringCheck","No text measuring events received"),await async function(e,n){for(let o=0;o<60;o++){const o=document.querySelectorAll("canvas");if(o.length){const t=n();return void([...o].every((e=>t.includes(e)))||await e.api.logError("init.patchedCanvasesCheck","Not all the document canvases have been patched"))}await t(1e3)}await e.api.logError("init.patchedCanvasesCheck","No document canvases found after 60 seconds")}(e,l)}catch(t){try{await e.api.logException("init",t)}catch(t){}}}()};!async function(){var t;let e;try{const n=document.documentElement.dataset.grGdcConnId||(document.documentElement.dataset.grGdcConnId=`${Date.now()}-${Math.random()}`),o=function(t){return{request:`gr-cs-request-${t}`,response:`gr-cs-response-${t}`}}(n);e=new l(new c(document,o.response,o.request)),e.api.log("injected.starting","Injected script initialization");const r=self[`GR_GDEI_${n}`];if(!r){console.error("Could not start grammarly integration","no early injected data found");const t={message:document.documentElement.dataset.grGdcErrorMsg,stack:document.documentElement.dataset.grGdcErrorStack};return void e.api.logError("injected.starting","No early injected data found",t)}const i=(null===(t=document.currentScript)||void 0===t?void 0:t.getAttribute("data-ext-version"))||"unknown",a=function(t){return{request:`gr-ics-request-${t}`,response:`gr-ics-response-${t}`}}(n);Je(e,i,(t=>{new St(function(t,e=s.create()){return{inbound:{subscribe:n=>t.inbound.subscribe({next(t){var o;if(n){const r={clientId:e,data:t};"function"==typeof n?n(r):null===(o=n.next)||void 0===o||o.call(n,r)}}})},outbound(n){n.clientId===e&&t.outbound(n.data)}}}(new c(document,a.request,a.response)),{replaceText:(e,...n)=>t.replaceText(...n),getLayoutTreeAvailability:()=>t.getLayoutTreeAvailability()})}))(r.addMiddleware,r.textMeasuringState,r.getPatchedCanvases)}catch(t){console.error("Could not start grammarly integration","module not loaded",t),e&&e.api.logException("injected.starting",t)}}()}();